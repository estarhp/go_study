# Redisæ•°æ®åº“

## Redisçš„å®‰è£…

[Rediså®˜ç½‘](https://redis.io/)

## Redisåˆè¯†

Rediså…¨ç§°ä¸ºï¼šRemote Dictionary Serverï¼ˆè¿œç¨‹æ•°æ®æœåŠ¡ï¼‰ï¼Œè¯¥è½¯ä»¶ä½¿ç”¨Cè¯­è¨€ç¼–å†™ï¼ŒRedisæ˜¯ä¸€ä¸ªkey-valueå­˜å‚¨ç³»ç»Ÿï¼Œå…¶æœ‰ä»¥ä¸‹ç‰¹ç‚¹ã€‚

- 1:æ€§èƒ½é«˜,å•çº¿ç¨‹éå¸¸é€‚åˆ**è¯»å¤šå†™å°‘**çš„åœºæ™¯,å¯ä»¥å‡è½»æ•°æ®åº“å‹åŠ›,
- 2.é›†ç¾¤åˆ†å¸ƒå¼å­˜å‚¨,å¯ä»¥æ¨ªå‘æ‹“å±•,å¯ä»¥åšåˆ°é«˜å¯ç”¨.
- 3.æ•°æ®ç»“æ„ç±»å‹ä¸°å¯Œæ•°æ®ç±»å‹
- 4.æ”¯æŒæ•°æ®æŒä¹…åŒ–
- 5.æ”¯æŒäº‹åŠ¡ï¼ˆä¸€èˆ¬ä¸ç”¨ï¼‰ä¸€èˆ¬é€šè¿‡luaè„šæœ¬å»å®ç°

è€Œåœ¨ä¸Šä¸€èŠ‚è¯¾æˆ‘ä»¬å­¦ä¹ äº†å…³ç³»å‹æ•°æ®åº“**MySQL**ï¼Œä»Šå¤©æˆ‘ä»¬å­¦ä¹ çš„æ˜¯éå…³ç³»å‹æ®åº“ï¼ˆNoSQLï¼‰**Redis ** ã€‚

> NoSQL= Not Only SQL ï¼ˆä¸ä»…ä»…æ˜¯SQL)æ³›æŒ‡éå…³ç³»å‹æ•°æ®åº“

#### é‚£ä»€ä¹ˆæ˜¯å…³ç³»å‹æ•°æ®åº“ï¼Œä»€ä¹ˆæ˜¯éå…³ç³»å‹æ•°æ®åº“å‘¢â”

**å…³ç³»å‹æ®åº“ï¼šå…³ç³»å‹æ•°æ®åº“æœ€å…¸å‹çš„æ•°æ®ç»“æ„æ˜¯è¡¨**ï¼Œç”±**äºŒç»´è¡¨**åŠå…¶**ä¹‹é—´çš„è”ç³»**æ‰€ç»„æˆçš„ä¸€ä¸ªæ•°æ®ç»„ç»‡ï¼Œå…¶éµå¾ªACIDåŸåˆ™

> **ä¼˜ç‚¹ï¼š** 1ã€æ˜“äºç»´æŠ¤ï¼šéƒ½æ˜¯ä½¿ç”¨è¡¨ç»“æ„ï¼Œæ ¼å¼ä¸€è‡´ï¼›2ã€ä½¿ç”¨æ–¹ä¾¿ï¼šæœ‰é€šç”¨çš„SQLè¯­è¨€ï¼›3ã€æ”¯æŒå¤æ‚æ“ä½œï¼šå¤šä¸ªè¡¨ä¹‹é—´åšç¹æ‚çš„æŸ¥è¯¢ã€‚ **ç¼ºç‚¹**ï¼š 1ã€è¯»å†™æ€§èƒ½æ¯”è¾ƒå·®ï¼Œå°¤å…¶æ˜¯æµ·é‡æ•°æ®çš„é«˜æ•ˆç‡è¯»å†™ï¼›2ã€å›ºå®šçš„è¡¨ç»“æ„ï¼Œçµæ´»åº¦ç¨æ¬ ï¼›3ã€é«˜å¹¶å‘è¯»å†™æœ‰IOç“¶é¢ˆã€‚

å¸¸è§çš„æœ‰ **MySQL/Oracle/SQL Server/Sqlite/TiDB/PostgreSQL/MariaDB**

**éå…³ç³»å‹æ®åº“**ï¼š

ä¸€èˆ¬ é™¤äº†ä¸»æµçš„å…³ç³»å‹æ•°æ®åº“å¤–çš„æ•°æ®åº“ï¼Œéƒ½è®¤ä¸ºæ˜¯éå…³ç³»å‹ã€‚

> **ä¼˜ç‚¹ï¼š** 1ã€æ ¼å¼çµæ´»ï¼šå­˜å‚¨æ•°æ®çš„æ ¼å¼å¯ä»¥æ˜¯key,valueå½¢å¼ã€æ–‡æ¡£å½¢å¼ã€å›¾ç‰‡å½¢å¼ã€‚2ã€é€Ÿåº¦å¿«ï¼šNoSQLå¯ä»¥ä½¿ç”¨ç¡¬ç›˜æˆ–è€…éšæœºå­˜å‚¨å™¨ä½œä¸ºè½½ä½“ï¼Œè€Œå…³ç³»å‹æ•°æ®åº“åªèƒ½ä½¿ç”¨ç¡¬ç›˜ï¼›3ã€é«˜æ‰©å±•æ€§ï¼›4ã€æˆæœ¬ä½ã€‚
>
> **ç¼ºç‚¹ï¼š** 1ã€ä¸€èˆ¬è€Œè¨€æ²¡æœ‰å¤ªå¼ºçš„äº‹åŠ¡å¤„ç†ï¼›2ã€æ•°æ®ç»“æ„ç›¸å¯¹å¤æ‚ï¼Œå¤æ‚æŸ¥è¯¢æ–¹é¢ç¨æ¬ ã€‚

å¸¸è§çš„æœ‰ **Redis / HBase /MongoDB /CouchDB /Neo4J**

## Redisæ•°æ®ç±»å‹å’Œå‘½ä»¤

Redis ç›®å‰æœ‰9ç§æ•°æ®ç±»å‹å’Œ

**5ç§å¸¸è§ç±»å‹ï¼š**Stringï¼ˆå­—ç¬¦ä¸²ï¼‰ï¼ŒHashï¼ˆå“ˆå¸Œï¼‰ï¼ŒListï¼ˆåˆ—è¡¨ï¼‰ï¼ŒSetï¼ˆé›†åˆï¼‰ã€Zsetï¼ˆæœ‰åºé›†åˆï¼‰

**4ç§æ–°å¢ç±»å‹ï¼š**BitMapï¼ˆ2.2 ç‰ˆæ–°å¢ï¼‰ã€HyperLogLogï¼ˆ2.8 ç‰ˆæ–°å¢ï¼‰ã€GEOï¼ˆ3.2 ç‰ˆæ–°å¢ï¼‰ã€Streamï¼ˆ5.0 ç‰ˆæ–°å¢ï¼‰

### **åŸºæœ¬å‘½ä»¤**

`redis-cli` è¿›å…¥Rediså‘½ä»¤è¡Œç•Œé¢

```
root@bc2c25de5155:/data# redis-cli
127.0.0.1:6379>
```



```
auth [username] password ` é»˜è®¤ç”¨æˆ·æ˜¯`default
127.0.0.1:6379> auth default 123456
OK
127.0.0.1:6379> auth 123456
OK
```



`dbsize` æ“¦çœ‹æ•°æ®åº“çš„keyæ•°é‡

```
127.0.0.1:6379> dbsize
(integer) 1
```



`select index`é€‰æ‹©æ•°æ®åº“ é»˜è®¤æ˜¯0

```
127.0.0.1:6379> select 0
OK
```



`help @åŸºæœ¬æ•°æ®ç±»å‹` æŸ¥çœ‹å‘½ä»¤

```
127.0.0.1:6379> help @string
```



`flushall` åˆ é™¤æ‰€æœ‰key

`keys *` æŸ¥çœ‹æ‰€æœ‰çš„key

`exit` or ` quit`é€€å‡ºå‘½ä»¤è¡Œ

### å­—ç¬¦ä¸²

String æ˜¯æœ€åŸºæœ¬çš„ key-value ç»“æ„ï¼Œkey æ˜¯å”¯ä¸€æ ‡è¯†ï¼Œvalue æ˜¯å…·ä½“çš„å€¼ï¼Œvalueå…¶å®ä¸ä»…æ˜¯[å­—ç¬¦ä¸²](https://so.csdn.net/so/search?q=å­—ç¬¦ä¸²&spm=1001.2101.3001.7020)ï¼Œ ä¹Ÿå¯ä»¥æ˜¯æ•°å­—ï¼ˆæ•´æ•°æˆ–æµ®ç‚¹æ•°ï¼‰ï¼Œvalue æœ€å¤šå¯ä»¥å®¹çº³çš„æ•°æ®é•¿åº¦æ˜¯ `512M`ã€‚

**åº•å±‚å®ç°ï¼š**String ç±»å‹çš„åº•å±‚çš„æ•°æ®ç»“æ„å®ç°ä¸»è¦æ˜¯ int å’Œ SDSï¼ˆç®€å•åŠ¨æ€å­—ç¬¦ä¸²ï¼‰ã€‚

#### åŸºæœ¬å‘½ä»¤

##### SET

è¯­æ³• (ä¸å¼ºåˆ¶å¤§å°å†™)

```
SET key value [EX seconds|PX milliseconds|EXAT timestamp|PXAT milliseconds-timestamp|KEEPTTL] [NX|XX] [GET]
```

**EX**:è¡¨æ˜è¿‡æœŸæ—¶é—´ï¼Œå•ä½æ˜¯ç§’ å’Œ **setex** ç›¸åŒ

**PX**:å•ä½æ¯«ç§’

**EXAT**:è®¾ç½®æ—¶é—´åˆ°æŸä¸ªæ—¶é—´æˆ³ï¼ˆç§’çº§ï¼‰

**PXAT**:è®¾ç½®æ—¶é—´åˆ°æŸä¸ªæ—¶é—´æˆ³ï¼ˆæ¯«ç§’çº§ï¼‰

**NX** ï¼šå½“é”®kä¸å­˜åœ¨æ—¶ï¼Œè®¾ç½®é”®ï¼›è®¾ç½®æˆåŠŸè¿”å›okï¼Œä¸æˆåŠŸæ—¶è¿”å›nilï¼›å’Œ**SETNX**ç­‰ä»·

**XX**ï¼š ä¸NXç›¸ååªåœ¨é”®å·²ç»å­˜åœ¨æ—¶ï¼Œ æ‰å¯¹é”®è¿›è¡Œè®¾ç½®æ“ä½œ

**GET**: è¿”å›ä¹‹å‰è®¾çš„å€¼

```
127.0.0.1:6379> SET wx 666
OK
127.0.0.1:6379> GET wx
"666"
127.0.0.1:6379> TTL wx
(integer) -1
```



> **ttl** æŸ¥çœ‹Keyçš„è¿‡æœŸæ—¶é—´(ms) -1æ˜¯æ°¸ä¹… -2æ˜¯ä¸å­˜åœ¨æˆ–ç€å·²è¿‡æœŸ

```
127.0.0.1:6379> SET wx 666  EX 666
OK
127.0.0.1:6379> TTL wx
(integer) 662
127.0.0.1:6379> SET wx 666 EXAT 1668931126576
OK
127.0.0.1:6379> TTL wx
(integer) 1667262367568
127.0.0.1:6379> SET wx 666 PXAT 1668931126576
OK
```



**XXä¸NXé€‰é¡¹**: NXå½“é”®kä¸å­˜åœ¨æ—¶ï¼Œè®¾ç½®é”® ; XXåˆ™åœ¨è¿™ä¸ªkå­˜åœ¨æ—¶è®¾ç½®

```
127.0.0.1:6379> SET wx 999  NX
(nil)
127.0.0.1:6379> SET yxh 999 NX
OK
127.0.0.1:6379> GET yxh
"999"
127.0.0.1:6379> GET wx
"666"
127.0.0.1:6379> SET wx 999 XX
OK
127.0.0.1:6379> GET wx
"999"
```



GET ä¼šè¿”å›ä¹‹å‰çš„value å¦‚æœkeyä¸å­˜åœ¨SETä¸ä¼šå¤±è´¥

```
127.0.0.1:6379> SET yxh 999
OK
127.0.0.1:6379> SET yxh 1 GET
"999"
127.0.0.1:6379> SET lmj 1 GET
(nil)  
127.0.0.1:6379> GET lmj
"1"
```



##### SETEX

è¯­æ³•:` setex key seconds value`

å’Œ set key value ex ä¸€æ ·

##### PSETEX

è¯­æ³•ï¼š`psetex key milliseconds value`

å’Œ set key value px ä¸€æ ·

##### MSET

è¯­æ³•ï¼š` MSET key value [key value ...]`

åŒæ—¶è®¾ç½®å¤šä¸ªé”®å€¼å¯¹ è¿”å›OK

```
127.0.0.1:6379> MSET wx  1 lmj 2
OK
```



##### MGET

```
127.0.0.1:6379> MGET wx  lmj
1) "1"
2) "2"
```



##### MSETNX

è¯­æ³•ï¼š`msetnx key value [key value ...]`

msetnx a 1 b 2 c 3 æ‰¹é‡è®¾ç½®é”®å€¼å¯¹ï¼Œå½“æ‰€æœ‰keyéƒ½ä¸å­˜åœ¨æ—¶è¿”å›1ï¼Œå¦åˆ™è¿”å›0

```
127.0.0.1:6379> msetnx a 1 b 2 c 3
(integer) 1
127.0.0.1:6379> msetnx a 1 b 2 c 3
(integer) 0
```



##### GET

è¯­æ³•ï¼š`GET key`

```
127.0.0.1:6379> GET lmj
"1"
```



##### GETEX

è¯­æ³•ï¼š`GETEX key [EX seconds|PX milliseconds|EXAT timestamp|PXAT milliseconds-timestamp|PERSIST]`

- ç”¨äºè·å–kçš„å€¼ï¼Œå¹¶è®¾ç½®æˆ–è€…ç§»é™¤è¿‡æœŸæ—¶é—´ï¼Œå‚æ•°ç±»ä¼¼äºset
- EX,PX,EXAT,PXAT å’Œsetçš„ç›¸åŒ
- PERSISTç§»é™¤kçš„è¿‡æœŸæ—¶é—´

ç›¸å½“äºæˆ–å€¼å¹¶ä¸”é‡æ–°è®¾ç½®è¿‡æœŸæ—¶é—´

```
127.0.0.1:6379> GETEX lmj EX 1
"2"
127.0.0.1:6379> GET lmj
(nil)
```



##### GETSET

è¯­æ³• `getset key value`

å’Œ set key value get ç›¸åŒ

##### GETRANGE

è¯­æ³•ï¼š`getrange key start end`

æˆªå–å­—ç¬¦ä¸² ä¸‹æ ‡ä»0å¼€å§‹

```
127.0.0.1:6379> getrange lanshan 0 2
"lan"
```



##### SETRANGE

è¯­æ³•ï¼š `setrange key offset value`

setrange ç”¨valueä»åç§»é‡ï¼ˆoffsetï¼‰å¼€å§‹(åŒ…æ‹¬offset)ï¼Œè¦†ç›–keyçš„å€¼

å¦‚

```
127.0.0.1:6379> set key abc
OK
127.0.0.1:6379> setrange key 2 def
(integer) 5
127.0.0.1:6379> get key
"abdef"
```



##### STRLEN

è¯­æ³• `strlen key`

strlen key è¿”å›é”®keyå­˜å‚¨çš„å€¼çš„é•¿åº¦ï¼Œ**ä¸å­˜åœ¨çš„kè¿”å›0**

```
127.0.0.1:6379> strlen lmj
(integer) 3
```



##### INCR

è¯­æ³•`incr key`

incr å¯¹keyçš„å€¼åŠ 1ï¼Œå¹¶è¿”å›åŠ 1åçš„ç»“æœï¼›å¦‚æœkçš„å€¼æ˜¯å­—ç¬¦ä¸²ï¼Œæ— æ³•åŠ 1ï¼Œåˆ™æç¤ºé”™è¯¯

```
127.0.0.1:6379> set k 1
OK
127.0.0.1:6379> incr k
(integer) 2
127.0.0.1:6379> set k wx
OK
127.0.0.1:6379> incr k
(error) ERR value is not an integer or out of range
```



##### INCRBY

è¯­æ³• `incrby key increment`

ç±»ä¼¼ INCR åªä¸è¿‡å¯ä»¥è®¾ç½®ä»»æ„æ•°

```
127.0.0.1:6379> get k
"8"
127.0.0.1:6379> incrby k  2
(integer) 10
```



##### INCRBYFLOAT

è¯­æ³•ï¼š`incrbyfloat key increment`

å¢åŠ æµ®ç‚¹å€¼æˆ–è€…åŠ æ•´å‹å€¼

```
127.0.0.1:6379> get k
"0.3"
127.0.0.1:6379> incrbyfloat k 0.2
"0.5"
127.0.0.1:6379> incrbyfloat k 1
"1.5"
```



##### DECR

è¯­æ³• `decr key`

å€¼å‡ä¸€ ç±»ä¼¼incr

##### DECRBY

è¯­æ³• : `decrby key decrement`

è‡ªå®šä¹‰å‡å€¼ ç±»ä¼¼incrby

##### APPEND

è¯­æ³• `append key value`

```
127.0.0.1:6379> set k 12
OK
127.0.0.1:6379> append k 345
(integer) 5
127.0.0.1:6379> get k
"12345"
```



**DEL**

è¯­æ³• `del key` åˆ é™¤å€¼

```
127.0.0.1:6379> del k
(integer) 1
127.0.0.1:6379> get k
(nil)
```



#### åº”ç”¨åœºæ™¯

##### ç¼“å­˜å¯¹è±¡

ä½¿ç”¨ String æ¥ç¼“å­˜å¯¹è±¡æœ‰ä¸¤ç§æ–¹å¼ï¼š

- ç›´æ¥ç¼“å­˜æ•´ä¸ªå¯¹è±¡çš„ JSONï¼Œå‘½ä»¤ä¾‹å­ï¼š `SET user:1 '{"name":"wxgg", "age":18}'`ã€‚
- é‡‡ç”¨å°† key è¿›è¡Œåˆ†ç¦»ä¸º user:ID:å±æ€§ï¼Œé‡‡ç”¨ MSET å­˜å‚¨ï¼Œç”¨ MGET è·å–å„å±æ€§å€¼ï¼Œå‘½ä»¤ä¾‹å­ï¼š `MSET user:1:name wxgg user:1:age 18 user:2:name wxjj user:2:age 18`ã€‚

##### å¸¸è§„è®¡æ•°

å› ä¸º Redis å¤„ç†å‘½ä»¤æ˜¯å•çº¿ç¨‹ï¼Œæ‰€ä»¥æ‰§è¡Œå‘½ä»¤çš„è¿‡ç¨‹æ˜¯åŸå­çš„ã€‚å› æ­¤ String æ•°æ®ç±»å‹é€‚åˆè®¡æ•°åœºæ™¯ï¼Œæ¯”å¦‚è®¡ç®—è®¿é—®æ¬¡æ•°ã€ç‚¹èµã€è½¬å‘ã€åº“å­˜æ•°é‡ç­‰ç­‰ã€‚

##### åˆ†å¸ƒå¼é”

SET å‘½ä»¤æœ‰ä¸ª NX å‚æ•°å¯ä»¥å®ç°ã€Œkeyä¸å­˜åœ¨æ‰æ’å…¥ã€ï¼Œå¯ä»¥ç”¨å®ƒæ¥å®ç°åˆ†å¸ƒå¼é”ï¼š

- å¦‚æœ key ä¸å­˜åœ¨ï¼Œåˆ™æ˜¾ç¤ºæ’å…¥æˆåŠŸï¼Œå¯ä»¥ç”¨æ¥è¡¨ç¤ºåŠ é”æˆåŠŸï¼›
- å¦‚æœ key å­˜åœ¨ï¼Œåˆ™ä¼šæ˜¾ç¤ºæ’å…¥å¤±è´¥ï¼Œå¯ä»¥ç”¨æ¥è¡¨ç¤ºåŠ é”å¤±è´¥ã€‚

### å“ˆå¸Œ

Hash æ˜¯ä¸€ä¸ªé”®å€¼å¯¹ï¼ˆkey - valueï¼‰é›†åˆï¼Œå…¶ä¸­ value çš„å½¢å¼å…¥ï¼š `value=[{field1ï¼Œvalue1}ï¼Œ...{fieldNï¼ŒvalueN}]`ã€‚Hash ç‰¹åˆ«é€‚åˆç”¨äºå­˜å‚¨å¯¹è±¡ã€‚

#### å†…éƒ¨å®ç°

Hash ç±»å‹çš„åº•å±‚æ•°æ®ç»“æ„æ˜¯ç”±**å‹ç¼©åˆ—è¡¨æˆ–å“ˆå¸Œè¡¨**å®ç°çš„ï¼š

- å¦‚æœå“ˆå¸Œç±»å‹å…ƒç´ ä¸ªæ•°å°äº `512` ä¸ªï¼ˆé»˜è®¤å€¼ï¼Œå¯ç”± `hash-max-ziplist-entries` é…ç½®ï¼‰ï¼Œæ‰€æœ‰å€¼å°äº `64` å­—èŠ‚ï¼ˆé»˜è®¤å€¼ï¼Œå¯ç”± `hash-max-ziplist-value` é…ç½®ï¼‰çš„è¯ï¼ŒRedis ä¼šä½¿ç”¨**å‹ç¼©åˆ—è¡¨**ä½œä¸º Hash ç±»å‹çš„åº•å±‚æ•°æ®ç»“æ„ï¼›
- å¦‚æœå“ˆå¸Œç±»å‹å…ƒç´ ä¸æ»¡è¶³ä¸Šé¢æ¡ä»¶ï¼ŒRedis ä¼šä½¿ç”¨**å“ˆå¸Œè¡¨**ä½œä¸º Hash ç±»å‹çš„ åº•å±‚æ•°æ®ç»“æ„ã€‚

**åœ¨ Redis 7.0 ä¸­ï¼Œå‹ç¼©åˆ—è¡¨æ•°æ®ç»“æ„å·²ç»åºŸå¼ƒäº†ï¼Œäº¤ç”± listpack (ç´§å‡‘åˆ—è¡¨)æ•°æ®ç»“æ„æ¥å®ç°äº†**ã€‚

Hash ç±»å‹çš„åº•å±‚æ•°æ®ç»“æ„æ˜¯ç”±**å‹ç¼©åˆ—è¡¨æˆ–å“ˆå¸Œè¡¨**å®ç°çš„ï¼š

- å¦‚æœå“ˆå¸Œç±»å‹å…ƒç´ ä¸ªæ•°å°äº `512` ä¸ªï¼ˆé»˜è®¤å€¼ï¼Œå¯ç”± `hash-max-ziplist-entries` é…ç½®ï¼‰ï¼Œæ‰€æœ‰å€¼å°äº `64` å­—èŠ‚ï¼ˆé»˜è®¤å€¼ï¼Œå¯ç”± `hash-max-ziplist-value` é…ç½®ï¼‰çš„è¯ï¼ŒRedis ä¼šä½¿ç”¨**å‹ç¼©åˆ—è¡¨**ä½œä¸º Hash ç±»å‹çš„åº•å±‚æ•°æ®ç»“æ„ï¼›
- å¦‚æœå“ˆå¸Œç±»å‹å…ƒç´ ä¸æ»¡è¶³ä¸Šé¢æ¡ä»¶ï¼ŒRedis ä¼šä½¿ç”¨**å“ˆå¸Œè¡¨**ä½œä¸º Hash ç±»å‹çš„ åº•å±‚æ•°æ®ç»“æ„ã€‚

**åœ¨ Redis 7.0 ä¸­ï¼Œå‹ç¼©åˆ—è¡¨æ•°æ®ç»“æ„å·²ç»åºŸå¼ƒäº†ï¼Œäº¤ç”± listpack æ•°æ®ç»“æ„æ¥å®ç°äº†**ã€‚

#### åŸºæœ¬å‘½ä»¤

##### HSET

è¯­æ³• `hset key field value`

ä¸€ä¸ªkeyçš„å€¼å¯ä»¥æœ‰å¤šä¸ª fieldä½†ä¸€ä¸ª fieldåªèƒ½æœ‰ä¸€ä¸ª value å¯ä»¥å’Œ goä¸­çš„map ä¸€èµ·ç†è§£

```
127.0.0.1:6379> hset gocybee wx 666
(integer) 1
127.0.0.1:6379> hset gocybee yxh 666
(integer) 1
```



##### HSETNX

è¯­æ³• `hsetnx key field value`

è®¾ç½®å“ˆå¸Œçš„ä¸€ä¸ªå­—æ®µï¼Œå½“æŒ‡å®šçš„å­—æ®µä¸å­˜åœ¨æ—¶æ‰ä¼šè¢«è®¾ç½®

```
127.0.0.1:6379> hset wx age 18
(integer) 1
127.0.0.1:6379> hsetnx wx age 18
(integer) 0
127.0.0.1:6379> hsetnx wx weight 70
(integer) 1
1234
```



åœ¨ä¸Šé¢çš„å‘½ä»¤ä¸­ï¼Œage å­—æ®µå·²ç»å­˜åœ¨äº wxè¿™ä¸ª key ä¸­ï¼Œå› æ­¤ hsetnx å‘½ä»¤çš„æ‰§è¡Œå¹¶æ²¡æœ‰æ·»åŠ æˆ–ä¿®æ”¹ ageï¼Œè€Œ weight åœ¨ wxè¿™ä¸ª key ä¸­æ˜¯ä¸å­˜åœ¨çš„ï¼Œå› æ­¤ weight è¢«æ·»åŠ åˆ° wxä¸­ã€‚

##### HMSET

è¯­æ³•ï¼š `hmset key field value [field value ...]`

```
127.0.0.1:6379> hset wx age 18  weight 60
(integer) 1
```



##### HGET

è¯­æ³•ï¼š ` hget key field`

```
127.0.0.1:6379> hget wx age
"18"
```



##### HGETALL

è·å–å“ˆå¸Œçš„æ‰€æœ‰å­—æ®µçš„å€¼ï¼Œè¯¥å‘½ä»¤çš„ç”¨æ³•å¦‚ä¸‹ï¼š

```
hgetall key
127.0.0.1:6379> hgetall wx
1) "age"
2) "18"
3) "weight"
4) "60"
```



å‰ä¸€ä¸ªæ˜¯field åé¢æ˜¯value

##### HkEYS

è¯­æ³•ï¼š`hkeys key`

è¯¥å‘½ä»¤çš„ä½œç”¨æ˜¯ï¼šè·å–å“ˆå¸Œçš„æ‰€æœ‰å­—æ®µï¼Œä½†æ˜¯ä¸è·å–å€¼

```
127.0.0.1:6379> hkeys wx
1) "age"
2) "weight"
```



##### HEXISTS

è¯­æ³•ï¼š`hexists key field`

è¯¥å‘½ä»¤çš„ä½œç”¨æ˜¯ï¼šåˆ¤æ–­å­—æ®µæ˜¯å¦å­˜åœ¨äºæŒ‡å®šå“ˆå¸Œä¸­

```
127.0.0.1:6379> hexists wx age
(integer) 1
127.0.0.1:6379> hexists wx tall
(integer) 0
```



##### HLEN

è¯­æ³•ï¼š `hlen key`

è·å–æŒ‡å®šå“ˆå¸Œä¸­å­—æ®µçš„æ•°é‡

```
127.0.0.1:6379> hlen wx
(integer) 2
```



##### HMGET

è¯­æ³• ï¼š ` hmget key field [field ...]`

è·å–æŒ‡å®šå“ˆå¸Œä¸­çš„å¤šä¸ªå­—æ®µ

```
127.0.0.1:6379> hmget wx age weight
1) "18"
2) "60"
```



##### HSTRLEN

è¯­æ³• ï¼š `hstrlen key field`

è¯¥å‘½ä»¤çš„ä½œç”¨æ˜¯ï¼šè·å–æŒ‡å®šå“ˆå¸Œä¸­å­—æ®µçš„é•¿åº¦ï¼Œ

```
127.0.0.1:6379> hstrlen wx age
(integer) 2
```



##### HVALS

è¯­æ³•ï¼š `hvals key`

è¯¥å‘½ä»¤çš„ä½œç”¨æ˜¯ï¼šè·å–æŒ‡å®šå“ˆå¸Œçš„æ‰€æœ‰å€¼ï¼Œä¸è·å–å­—æ®µåç§°

```
127.0.0.1:6379> hvals wx
1) "18"
2) "60"
```



##### HINCRBY

è¯­æ³•ï¼š `hincrby key field increment`

å’Œ incrybyç±»ä¼¼ å°†æŒ‡å®šå“ˆå¸Œä¸­çš„æŒ‡å®šå­—æ®µçš„å€¼åŠ ä¸€ä¸ªæŒ‡å®šçš„æ•´å‹å€¼

##### HINCRBYFLOAT

è¯­æ³•ï¼š `hincrbyfloat key field increment`

å°†æŒ‡å®šå“ˆå¸Œä¸­çš„æŒ‡å®šå­—æ®µçš„å€¼åŠ ä¸€ä¸ªæŒ‡å®šçš„æµ®ç‚¹å‹å€¼ ä¹Ÿå¯ä»¥åŠ æ•´å‹å€¼

```
127.0.0.1:6379> hincrbyfloat wx age 0.5
"18.5"
127.0.0.1:6379> hget wx age
"18.5"
127.0.0.1:6379> hincrbyfloat wx age 1
"19.5"
```



##### HDEL

è¯­æ³•: `hdel key`

åˆ é™¤å“ˆå¸Œä¸­æŒ‡å®šä¸€ä¸ªæˆ–å¤šä¸ªå­—æ®µ

```
127.0.0.1:6379> hdel wx b
(integer) 1
127.0.0.1:6379> hkeys wx
1) "age"
2) "weight"
127.0.0.1:6379> hdel wx age weight
(integer) 2
127.0.0.1:6379> hkeys wx
(empty array)
```



#### åº”ç”¨åœºæ™¯

##### ç¼“å­˜å¯¹è±¡

Hash ç±»å‹çš„ ï¼ˆkeyï¼Œfieldï¼Œ valueï¼‰ çš„ç»“æ„ä¸å¯¹è±¡çš„ï¼ˆå¯¹è±¡idï¼Œ å±æ€§ï¼Œ å€¼ï¼‰çš„ç»“æ„ç›¸ä¼¼ï¼Œä¹Ÿå¯ä»¥ç”¨æ¥å­˜å‚¨å¯¹è±¡ã€‚

| id   | name | age  |
| ---- | ---- | ---- |
| 1    | lmj  | 18   |
| 2    | wx   | 18   |
| 3    | yxh  | 18   |

æˆ‘ä»¬å¯ä»¥è¿™æ ·æ¥å­˜å‚¨å¯¹è±¡

```
 HSET uid:1 name lmj age 18
 HSET uid:2 name wx  age 18
 HSET uid:2 name yxh age 18
 
```



### åˆ—è¡¨

List åˆ—è¡¨æ˜¯ç®€å•çš„å­—ç¬¦ä¸²åˆ—è¡¨ï¼Œ**æŒ‰ç…§æ’å…¥é¡ºåºæ’åº**ï¼Œå¯ä»¥ä»å¤´éƒ¨æˆ–å°¾éƒ¨å‘ List åˆ—è¡¨æ·»åŠ å…ƒç´ ã€‚

åˆ—è¡¨çš„æœ€å¤§é•¿åº¦ä¸º `2^32 - 1`ï¼Œä¹Ÿå³æ¯ä¸ªåˆ—è¡¨æ”¯æŒè¶…è¿‡ `40 äº¿`ä¸ªå…ƒç´ ã€‚

#### å†…éƒ¨å®ç°

List ç±»å‹çš„åº•å±‚æ•°æ®ç»“æ„æ˜¯ç”±**åŒå‘é“¾è¡¨æˆ–å‹ç¼©åˆ—è¡¨**å®ç°çš„ï¼š

- å¦‚æœåˆ—è¡¨çš„å…ƒç´ ä¸ªæ•°å°äº `512` ä¸ªï¼ˆé»˜è®¤å€¼ï¼Œå¯ç”± `list-max-ziplist-entries` é…ç½®ï¼‰ï¼Œåˆ—è¡¨æ¯ä¸ªå…ƒç´ çš„å€¼éƒ½å°äº `64` å­—èŠ‚ï¼ˆé»˜è®¤å€¼ï¼Œå¯ç”± `list-max-ziplist-value` é…ç½®ï¼‰ï¼ŒRedis ä¼šä½¿ç”¨**å‹ç¼©åˆ—è¡¨**ä½œä¸º List ç±»å‹çš„åº•å±‚æ•°æ®ç»“æ„ï¼›
- å¦‚æœåˆ—è¡¨çš„å…ƒç´ ä¸æ»¡è¶³ä¸Šé¢çš„æ¡ä»¶ï¼ŒRedis ä¼šä½¿ç”¨**åŒå‘é“¾è¡¨**ä½œä¸º List ç±»å‹çš„åº•å±‚æ•°æ®ç»“æ„ï¼›

ä½†æ˜¯**åœ¨ Redis 3.2 ç‰ˆæœ¬ä¹‹åï¼ŒList æ•°æ®ç±»å‹åº•å±‚æ•°æ®ç»“æ„å°±åªç”± quicklistï¼ˆå¿«é€Ÿè¡¨ï¼‰ å®ç°äº†ï¼Œæ›¿ä»£äº†åŒå‘é“¾è¡¨å’Œå‹ç¼©åˆ—è¡¨**ã€‚

#### åŸºæœ¬å‘½ä»¤

##### LPUSH

è¯­æ³•ï¼š ` lpush key element [element ...]`

å½“keyå­˜åœ¨ä½†æ˜¯å´ä¸æ˜¯åˆ—è¡¨ä¼šè¿”å›é”™è¯¯

```
127.0.0.1:6379> lpush gocybee 1 2 3 4 5 6
(integer) 6
```



##### LRANGE

è¯­æ³•ï¼š `LRANGE key start stop`

-1æ˜¯å€’æ•°ç¬¬ä¸€ä¸ª ä¾æ¬¡ç±»æ¨

```
127.0.0.1:6379> lrange gocybee 0 -1
1) "6"
2) "5"
3) "4"
4) "3"
5) "2"
6) "1"
```



##### LPOP

è¯­æ³•ï¼š`lpop key [count]`

ç§»é™¤åˆ—è¡¨keyçš„è¡¨å¤´å…ƒç´ ï¼Œå‡ºé˜Ÿåˆ— countsæ˜¯å‡ºé˜Ÿæ¬¡æ•°

```
127.0.0.1:6379> lpush gocybee 1
(integer) 1
```



##### RPOP

è¯­æ³•ï¼š`RPOP key [count]`

ç§»é™¤åˆ—è¡¨keyçš„å°¾å…ƒç´ ï¼Œå‡ºé˜Ÿåˆ— countsæ˜¯å‡ºé˜Ÿæ¬¡æ•°

```
127.0.0.1:6379> lrange gocybee 0 -1
1) "twh"
2) "tr"
3) "lmj"
4) "000"
127.0.0.1:6379> RPOP gocybee 1
1) "000"
```



##### LSET

è¯­æ³•ï¼š `lset key index element`

é€šè¿‡ç´¢å¼•è®¾ç½®åˆ—è¡¨å…ƒç´ çš„å€¼

```
127.0.0.1:6379> lrange gocybee 0 -1
1) "twh"
2) "lmj"
3) "wx"
4) "hhz"
127.0.0.1:6379> lset gocybee 1 tr
OK
127.0.0.1:6379> lrange gocybee 0 -1
1) "twh"
2) "tr"
3) "wx"
4) "hhz"
```



##### LLEN

è¯­æ³•ï¼š`llen key`

è·å–åˆ—è¡¨é•¿åº¦

```
127.0.0.1:6379> llen gocybee
(integer) 3
```



##### BLPOP

è¯­æ³•ï¼š `blpop key [key ...] timeout`

ç§»å‡ºå¹¶è·å–åˆ—è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œ å¦‚æœåˆ—è¡¨æ²¡æœ‰å…ƒç´ ä¼šé˜»å¡åˆ—è¡¨ç›´åˆ°ç­‰å¾…è¶…æ—¶æˆ–å‘ç°å¯å¼¹å‡ºå…ƒç´ ä¸ºæ­¢

timeout ï¼ˆsï¼‰

```
127.0.0.1:6379> lpush gocybee 'hello gocybee'
(integer) 1
```



```
127.0.0.1:6379> blpop gocybee 50
1) "gocybee"
2) "hello gocybee"
(22.08s)
```



å…¶ä»–å‘½ä»¤è‡ªè¡Œäº†è§£............... help @list è§£å†³

#### åº”ç”¨åœºæ™¯

æ¶ˆæ¯é˜Ÿåˆ— ä»¥åä¼šå­¦ ç°åœ¨ä¸è®²

### é›†åˆ

Set ç±»å‹æ˜¯ä¸€ä¸ªæ— åºå¹¶å”¯ä¸€çš„é”®å€¼é›†åˆï¼Œå®ƒçš„å­˜å‚¨é¡ºåºä¸ä¼šæŒ‰ç…§æ’å…¥çš„å…ˆåé¡ºåºè¿›è¡Œå­˜å‚¨ã€‚

ä¸€ä¸ªé›†åˆæœ€å¤šå¯ä»¥å­˜å‚¨ `2^32-1` ä¸ªå…ƒç´ ã€‚æ¦‚å¿µå’Œæ•°å­¦ä¸­ä¸ªçš„é›†åˆåŸºæœ¬ç±»ä¼¼ï¼Œå¯ä»¥äº¤é›†ï¼Œå¹¶é›†ï¼Œå·®é›†ç­‰ç­‰ï¼Œæ‰€ä»¥ Set ç±»å‹é™¤äº†æ”¯æŒé›†åˆå†…çš„å¢åˆ æ”¹æŸ¥ï¼ŒåŒæ—¶è¿˜æ”¯æŒå¤šä¸ªé›†åˆå–äº¤é›†ã€å¹¶é›†ã€å·®é›†ã€‚

Set ç±»å‹å’Œ List ç±»å‹çš„åŒºåˆ«å¦‚ä¸‹ï¼š

- List å¯ä»¥å­˜å‚¨é‡å¤å…ƒç´ ï¼ŒSet åªèƒ½å­˜å‚¨éé‡å¤å…ƒç´ ï¼›
- List æ˜¯æŒ‰ç…§å…ƒç´ çš„å…ˆåé¡ºåºå­˜å‚¨å…ƒç´ çš„ï¼Œè€Œ Set åˆ™æ˜¯æ— åºæ–¹å¼å­˜å‚¨å…ƒç´ çš„ã€‚

#### å†…éƒ¨å®ç°

Set ç±»å‹çš„åº•å±‚æ•°æ®ç»“æ„æ˜¯ç”±**å“ˆå¸Œè¡¨æˆ–æ•´æ•°é›†åˆ**å®ç°çš„ï¼š

- å¦‚æœé›†åˆä¸­çš„å…ƒç´ éƒ½æ˜¯æ•´æ•°ä¸”å…ƒç´ ä¸ªæ•°å°äº `512` ï¼ˆé»˜è®¤å€¼ï¼Œ`set-maxintset-entries`é…ç½®ï¼‰ä¸ªï¼ŒRedis ä¼šä½¿ç”¨**æ•´æ•°é›†åˆ**ä½œä¸º Set ç±»å‹çš„åº•å±‚æ•°æ®ç»“æ„ï¼›
- å¦‚æœé›†åˆä¸­çš„å…ƒç´ ä¸æ»¡è¶³ä¸Šé¢æ¡ä»¶ï¼Œåˆ™ Redis ä½¿ç”¨**å“ˆå¸Œè¡¨**ä½œä¸º Set ç±»å‹çš„åº•å±‚æ•°æ®ç»“æ„ã€‚

#### åŸºæœ¬å‘½ä»¤

##### SADD

è¯­æ³•ï¼š`SADD key member [member ...]`

å¾€é›†åˆkeyä¸­å­˜å…¥å…ƒç´ ï¼Œå…ƒç´ å­˜åœ¨åˆ™å¿½ç•¥ï¼Œè‹¥keyä¸å­˜åœ¨åˆ™æ–°å»º

```
127.0.0.1:6379> SADD gocybee 1
(integer) 1
127.0.0.1:6379> SADD gocybee 1
(integer) 0
```



##### SREM

è¯­æ³•ï¼š`SREM key member [member ...] `

ä»é›†åˆkeyä¸­åˆ é™¤å…ƒç´ 

```
127.0.0.1:6379> SREM gocybee 1
(integer) 1
127.0.0.1:6379> SREM gocybee 1
(integer) 0
```



##### SMEMBERS

è¯­æ³•ï¼š`SMEMBERS key`

æŸ¥çœ‹æ‰€æœ‰çš„members

```
127.0.0.1:6379> smembers gocybee
1) "wx"
```



##### SCARD

è¯­æ³•ï¼š`SCARD key`

æŸ¥çœ‹å…ƒç´ ä¸ªæ•°

```
127.0.0.1:6379> SCARD gocybee
(integer) 1
```



##### SISMEMBER

è¯­æ³•ï¼š`SISMEMBER key member`

åˆ¤æ–­å…ƒç´ æ˜¯å¦æ˜¯åœ¨é›†åˆä¸­

```
127.0.0.1:6379> SISmember gocybee wx
(integer) 1
```



##### SRANDMEMBER

è¯­æ³•ï¼š `SRANDMEMBER key [count]`

ä»é›†åˆkeyä¸­éšæœºé€‰å‡ºcountä¸ªå…ƒç´ ï¼Œå…ƒç´ ä¸ä»keyä¸­åˆ é™¤

```
127.0.0.1:6379> Srandmember gocybee 3
1) "yxh"
2) "hhz"
3) "mj"
```



##### SPOP

è¯­æ³•ï¼š ` SPOP key [count]`

ä»é›†åˆkeyä¸­éšæœºé€‰å‡ºcountä¸ªå…ƒç´ ï¼Œå…ƒç´ ä»keyä¸­åˆ é™¤

```
127.0.0.1:6379> Smembers gocybee
1) "yxh"
2) "hhz"
3) "wx"
127.0.0.1:6379> SPOP gocybee 1
1) "wx"
127.0.0.1:6379> Smembers gocybee
1) "yxh"
2) "hhz"
```



##### SINTER

è¯­æ³•ï¼š `SINTER key [key ...]`

äº¤é›†è¿ç®—è¿”å›ä¸¤ä¸ªsetçš„äº¤é›†

```
127.0.0.1:6379> Smembers gocybee
1) "yxh"
2) "hhz"
3) "mj"
127.0.0.1:6379> Smembers lanshan
1) "lpc"
2) "yxh"
3) "hhz"
4) "mj"
127.0.0.1:6379> SINTER  gocybee lanshan
1) "yxh"
2) "hhz"
3) "mj"
```



##### SINTERSTORE

è¯­æ³•ï¼š `SINTERSTORE destination key [key ...]`

å°†äº¤é›†ç»“æœå­˜å…¥æ–°é›†åˆdestinationä¸­

```
127.0.0.1:6379> SINTERSTORE common gocybee lanshan
(integer) 3
127.0.0.1:6379> smembers common
1) "yxh"
2) "hhz"
3) "mj"
```



##### SUNION

è¯­æ³•ï¼š `SUNION gocybee lanshan`

å¹¶é›†è¿ç®—

```
127.0.0.1:6379> SUNION gocybee lanshan
1) "hhz"
2) "mj"
3) "lpc"
4) "yxh"
```



##### SUNIONSTORE

è¯­æ³•ï¼š `SUNIONSTORE destination key [key ...]`

å°†å¹¶é›†ç»“æœå­˜å…¥æ–°é›†åˆdestinationä¸­

```
127.0.0.1:6379> SUNIONSTORE union gocybee lanshan
(integer) 4
127.0.0.1:6379> Smembers union
1) "mj"
2) "lpc"
3) "yxh"
4) "hhz"
```



##### SDIFF

å·®é›†è¿ç®— `SDIFF key [key ...]`

##### SDIFFSTORE

å°†å·®é›†ç»“æœå­˜å…¥æ–°é›†åˆdestinationä¸­ `SDIFFSTORE destination key [key ...]`

#### åº”ç”¨åœºæ™¯

é›†åˆçš„ä¸»è¦å‡ ä¸ªç‰¹æ€§ï¼Œæ— åºã€ä¸å¯é‡å¤ã€æ”¯æŒå¹¶äº¤å·®ç­‰æ“ä½œã€‚

å› æ­¤ Set ç±»å‹æ¯”è¾ƒé€‚åˆç”¨æ¥æ•°æ®å»é‡å’Œä¿éšœæ•°æ®çš„å”¯ä¸€æ€§ï¼Œè¿˜å¯ä»¥ç”¨æ¥ç»Ÿè®¡å¤šä¸ªé›†åˆçš„äº¤é›†ã€é”™é›†å’Œå¹¶é›†ç­‰ï¼Œå½“æˆ‘ä»¬å­˜å‚¨çš„æ•°æ®æ˜¯æ— åºå¹¶ä¸”éœ€è¦å»é‡çš„æƒ…å†µä¸‹ï¼Œæ¯”è¾ƒé€‚åˆä½¿ç”¨é›†åˆç±»å‹è¿›è¡Œå­˜å‚¨ã€‚

ä½†æ˜¯æœ‰ä¸€ä¸ªæ½œåœ¨çš„é£é™©ã€‚**Set çš„å·®é›†ã€å¹¶é›†å’Œäº¤é›†çš„è®¡ç®—å¤æ‚åº¦è¾ƒé«˜ï¼Œåœ¨æ•°æ®é‡è¾ƒå¤§çš„æƒ…å†µä¸‹ï¼Œå¦‚æœç›´æ¥æ‰§è¡Œè¿™äº›è®¡ç®—ï¼Œä¼šå¯¼è‡´ Redis å®ä¾‹é˜»å¡**ã€‚

åœ¨ä¸»ä»é›†ç¾¤ä¸­ï¼Œä¸ºäº†é¿å…ä¸»åº“å› ä¸º Set åšèšåˆè®¡ç®—ï¼ˆäº¤é›†ã€å·®é›†ã€å¹¶é›†ï¼‰æ—¶å¯¼è‡´ä¸»åº“è¢«é˜»å¡ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©ä¸€ä¸ªä»åº“å®Œæˆèšåˆç»Ÿè®¡ï¼Œæˆ–è€…æŠŠæ•°æ®è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œç”±å®¢æˆ·ç«¯æ¥å®Œæˆèšåˆç»Ÿè®¡ã€‚

##### ç‚¹èµ

Set ç±»å‹å¯ä»¥ä¿è¯ä¸€ä¸ªç”¨æˆ·åªèƒ½ç‚¹ä¸€ä¸ªèµï¼Œè¿™é‡Œä¸¾ä¾‹å­ä¸€ä¸ªåœºæ™¯ï¼Œkey æ˜¯æ–‡ç« idï¼Œvalue æ˜¯ç”¨æˆ·idã€‚

`uid:1` ã€`uid:2`ã€`uid:3` ä¸‰ä¸ªç”¨æˆ·åˆ†åˆ«å¯¹ article:1 æ–‡ç« ç‚¹èµäº†ã€‚

```
127.0.0.1:6379> SADD article:1 uid:1
(integer) 1
127.0.0.1:6379> SADD article:1 uid:2
(integer) 1
127.0.0.1:6379> SADD article:1 uid:3
(integer) 1
127.0.0.1:6379> SCARD article:1
(integer) 3
127.0.0.1:6379> SREM article:1 uid:1
(integer) 1
127.0.0.1:6379> SCARD article:1
(integer) 2
```



##### å…±åŒå…³æ³¨

Set ç±»å‹æ”¯æŒäº¤é›†è¿ç®—ï¼Œæ‰€ä»¥å¯ä»¥ç”¨æ¥è®¡ç®—å…±åŒå…³æ³¨çš„å¥½å‹ã€å…¬ä¼—å·ç­‰ã€‚

key å¯ä»¥æ˜¯ç”¨æˆ·idï¼Œvalue åˆ™æ˜¯å·²å…³æ³¨çš„å…¬ä¼—å·çš„idã€‚

`uid:1` ç”¨æˆ·å…³æ³¨é¢‘é“å· id ä¸º 5ã€6ã€7ã€8ã€9ï¼Œ`uid:2` ç”¨æˆ·å…³æ³¨ é¢‘é“å·id ä¸º 7ã€8ã€9ã€10ã€11ã€‚

```
127.0.0.1:6379> SADD uid:1 5 6 7 8 9
(integer) 5
127.0.0.1:6379> SADD uid:2 7 8 9 10 11
(integer) 5
```



æˆ‘ä»¬å¯ä»¥æŸ¥çœ‹ `uid:1` å’Œ `uid:2` å…±åŒå…³æ³¨çš„é¢‘é“

å¯ä»¥å‘`uid:2`æ¨è `uid:1` çš„é¢‘é“ç­‰ç­‰...

##### æŠ½å¥–æ´»åŠ¨

å­˜å‚¨æŸæ´»åŠ¨ä¸­ä¸­å¥–çš„ç”¨æˆ·å ï¼ŒSet ç±»å‹å› ä¸ºæœ‰å»é‡åŠŸèƒ½ï¼Œå¯ä»¥ä¿è¯åŒä¸€ä¸ªç”¨æˆ·ä¸ä¼šä¸­å¥–ä¸¤æ¬¡ã€‚

keyä¸ºæŠ½å¥–æ´»åŠ¨åï¼Œvalueä¸ºå‘˜å·¥åç§°ï¼ŒæŠŠæ‰€æœ‰å‘˜å·¥åç§°æ”¾å…¥æŠ½å¥–ç®±

å†åˆ©ç”¨ `SRANDRM `æˆ–è€…æ˜¯ `SPOP `

### æœ‰åºé›†åˆ

Zset ç±»å‹ï¼ˆæœ‰åºé›†åˆç±»å‹ï¼‰ç›¸æ¯”äº Set ç±»å‹å¤šäº†ä¸€ä¸ªæ’åºå±æ€§ scoreï¼ˆåˆ†å€¼ï¼‰ï¼Œå¯¹äºæœ‰åºé›†åˆ ZSet æ¥è¯´ï¼Œæ¯ä¸ªå­˜å‚¨å…ƒç´ ç›¸å½“äºæœ‰ä¸¤ä¸ªå€¼ç»„æˆçš„ï¼Œä¸€ä¸ªæ˜¯æœ‰åºç»“åˆçš„å…ƒç´ å€¼ï¼Œä¸€ä¸ªæ˜¯æ’åºå€¼ã€‚

æœ‰åºé›†åˆä¿ç•™äº†é›†åˆä¸èƒ½æœ‰é‡å¤æˆå‘˜çš„ç‰¹æ€§ï¼ˆåˆ†å€¼å¯ä»¥é‡å¤ï¼‰ï¼Œä½†ä¸åŒçš„æ˜¯ï¼Œæœ‰åºé›†åˆä¸­çš„å…ƒç´ å¯ä»¥æ’åºã€‚

##### å†…éƒ¨å®ç°

Zset ç±»å‹çš„åº•å±‚æ•°æ®ç»“æ„æ˜¯ç”±**å‹ç¼©åˆ—è¡¨æˆ–è·³è¡¨**å®ç°çš„ï¼š

- å¦‚æœæœ‰åºé›†åˆçš„å…ƒç´ ä¸ªæ•°å°äº `128` ä¸ªï¼Œå¹¶ä¸”æ¯ä¸ªå…ƒç´ çš„å€¼å°äº `64` å­—èŠ‚æ—¶ï¼ŒRedis ä¼šä½¿ç”¨**å‹ç¼©åˆ—è¡¨**ä½œä¸º Zset ç±»å‹çš„åº•å±‚æ•°æ®ç»“æ„ï¼›
- å¦‚æœæœ‰åºé›†åˆçš„å…ƒç´ ä¸æ»¡è¶³ä¸Šé¢çš„æ¡ä»¶ï¼ŒRedis ä¼šä½¿ç”¨**è·³è¡¨**ä½œä¸º Zset ç±»å‹çš„åº•å±‚æ•°æ®ç»“æ„ï¼›

**åœ¨ Redis 7.0 ä¸­ï¼Œå‹ç¼©åˆ—è¡¨æ•°æ®ç»“æ„å·²ç»åºŸå¼ƒäº†ï¼Œäº¤ç”± listpack æ•°æ®ç»“æ„æ¥å®ç°äº†ã€‚**

#### åŸºæœ¬å‘½ä»¤

##### ZADD

è¯­æ³• ï¼š`ZADD key score member [[score member]...]   `

å¾€æœ‰åºé›†åˆkeyä¸­åŠ å…¥å¸¦åˆ†å€¼å…ƒç´  ,coreå¿…é¡»æ˜¯æµ®ç‚¹æ•°æˆ–è€…æ•´å‹ï¼Œæ·»åŠ æˆåŠŸåè¿”å›è¢«æˆåŠŸæ·»åŠ çš„æ–°æˆå‘˜çš„æ•°é‡

```
127.0.0.1:6379> ZADD movie 1 zl 2 lldq
(integer) 2
```



##### ZREM

è¯­æ³• ï¼š`ZREM key member [member...]`

å¾€æœ‰åºé›†åˆkeyä¸­åˆ é™¤å…ƒç´ 

```
127.0.0.1:6379> ZREM movie zl
(integer) 1
```



##### ZSCORE

è¯­æ³•ï¼š `ZSCORE key member`

è¿”å›æœ‰åºé›†åˆkeyä¸­å…ƒç´ memberçš„åˆ†å€¼

```
127.0.0.1:6379> ZSCORE movie lldq
"2"
```



##### ZCARD

è¯­æ³•ï¼š `ZCARD key `

è¿”å›æœ‰åºé›†åˆä¸ªæ•°

```
127.0.0.1:6379> ZCARD movie
(integer) 1
```



##### ZINCRBY

```
ZINCRBY key increment member 
```

ä¸ºæœ‰åºé›†åˆkeyä¸­å…ƒç´ memberçš„åˆ†å€¼åŠ ä¸Šincrement

```
127.0.0.1:6379> ZINCRBY movie 3 lldq
"5"
```



##### ZRANGE

```
ZRANGE key start stop [WITHSCORES]
```

æ­£åºè·å–æœ‰åºé›†åˆkeyä»startä¸‹æ ‡åˆ°stopä¸‹æ ‡çš„å…ƒç´ 

```
127.0.0.1:6379> ZRANGE movie 0 -1
1) "zl"
2) "lldq"
```



##### ZREVRANGE

```
ZREVRANGE key start stop [WITHSCORES]
```

å€’åºè·å–æœ‰åºé›†åˆkeyä»startä¸‹æ ‡åˆ°stopä¸‹æ ‡çš„å…ƒç´ 

```
127.0.0.1:6379> ZREVRANGE movie  0 -1
1) "lldq"
2) "zl"
```



##### ZRANGENYSCORE

```
ZRANGEBYSCORE key min max [WITHSCORES] [LIMIT offset count]
```

è¿”å›æœ‰åºé›†åˆä¸­æŒ‡å®šåˆ†æ•°åŒºé—´å†…çš„æˆå‘˜ï¼Œåˆ†æ•°ç”±ä½åˆ°é«˜æ’åºã€‚

```
127.0.0.1:6379> ZRANGEBYSCORE movie 0 100
1) "zl"
2) "lldq"
```



##### ZREVRANGEBYSCORE

```
ZREVRANGEBYSCORE key max min [WITHSCORES] [LIMIT offset count]
```

è¿”å›æœ‰åºé›†åˆä¸­æŒ‡å®šåˆ†æ•°åŒºé—´å†…çš„æˆå‘˜ï¼Œåˆ†æ•°ç”±é«˜åˆ°ä½æ’åºã€‚

```
127.0.0.1:6379> ZREVRANGEBYSCORE movie 100 0
1) "lldq"
2) "zl"
127.0.0.1:6379> ZSCORE movie lldq
"5"
127.0.0.1:6379> ZSCORE movie zl
"4"
```



##### ZRANGEBYLEX

```
ZRANGEBYLEX key min max  [LIMIT offset count]
```

è¿”å›æŒ‡å®šæˆå‘˜åŒºé—´å†…çš„æˆå‘˜ï¼ŒæŒ‰å­—å…¸æ­£åºæ’åˆ—, åˆ†æ•°å¿…é¡»ç›¸åŒ

```
127.0.0.1:6379> ZRANGEBYLEX movie - [zl
1) "zl"
2) "lldq"
```



##### ZREVRANGEBYLEX

```
ZREVRANGEBYLEX key max min [LIMIT offset count]
```

è¿”å›æŒ‡å®šæˆå‘˜åŒºé—´å†…çš„æˆå‘˜ï¼ŒæŒ‰å­—å…¸å€’åºæ’åˆ—, åˆ†æ•°å¿…é¡»ç›¸åŒ

> **+ - ** è¡¨ç¤ºæ­£æ— é™ å’Œè´Ÿæ— é™
>
> ( ä¸åŒ…å« [ åŒ…å«

#### åº”ç”¨åœºæ™¯

Zset ç±»å‹ï¼ˆSorted Setï¼Œæœ‰åºé›†åˆï¼‰ å¯ä»¥æ ¹æ®å…ƒç´ çš„æƒé‡æ¥æ’åºï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå·±æ¥å†³å®šæ¯ä¸ªå…ƒç´ çš„æƒé‡å€¼ã€‚æ¯”å¦‚è¯´ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®å…ƒç´ æ’å…¥ Sorted Set çš„æ—¶é—´ç¡®å®šæƒé‡å€¼ï¼Œå…ˆæ’å…¥çš„å…ƒç´ æƒé‡å°ï¼Œåæ’å…¥çš„å…ƒç´ æƒé‡å¤§ã€‚

åœ¨é¢å¯¹éœ€è¦å±•ç¤ºæœ€æ–°åˆ—è¡¨ã€æ’è¡Œæ¦œç­‰åœºæ™¯æ—¶ï¼Œå¦‚æœæ•°æ®æ›´æ–°é¢‘ç¹æˆ–è€…éœ€è¦åˆ†é¡µæ˜¾ç¤ºï¼Œå¯ä»¥ä¼˜å…ˆè€ƒè™‘ä½¿ç”¨ Sorted Setã€‚

##### æ’è¡Œæ¦œ

æœ‰åºé›†åˆæ¯”è¾ƒå…¸å‹çš„ä½¿ç”¨åœºæ™¯å°±æ˜¯æ’è¡Œæ¦œã€‚ä¾‹å¦‚å­¦ç”Ÿæˆç»©çš„æ’åæ¦œã€æ¸¸æˆç§¯åˆ†æ’è¡Œæ¦œã€è§†é¢‘æ’­æ”¾æ’åã€ç”µå•†ç³»ç»Ÿä¸­å•†å“çš„é”€é‡æ’åç­‰ã€‚

##### ç”µè¯ã€å§“åæ’åº

ä½¿ç”¨æœ‰åºé›†åˆçš„ `ZRANGEBYLEX` æˆ– `ZREVRANGEBYLEX` å¯ä»¥å¸®åŠ©æˆ‘ä»¬å®ç°ç”µè¯å·ç æˆ–å§“åçš„æ’åºï¼Œæˆ‘ä»¬ä»¥ `ZRANGEBYLEX` ï¼ˆè¿”å›æŒ‡å®šæˆå‘˜åŒºé—´å†…çš„æˆå‘˜ï¼ŒæŒ‰ key æ­£åºæ’åˆ—ï¼Œåˆ†æ•°å¿…é¡»ç›¸åŒï¼‰ä¸ºä¾‹ã€‚

### ä½å›¾

Bitmapï¼Œå³ä½å›¾ï¼Œæ˜¯ä¸€ä¸²è¿ç»­çš„äºŒè¿›åˆ¶æ•°ç»„ï¼ˆ0å’Œ1ï¼‰ï¼Œå¯ä»¥é€šè¿‡åç§»é‡ï¼ˆoffsetï¼‰å®šä½å…ƒç´ ã€‚BitMapé€šè¿‡æœ€å°çš„å•ä½bitæ¥è¿›è¡Œ`0|1`çš„è®¾ç½®ï¼Œè¡¨ç¤ºæŸä¸ªå…ƒç´ çš„å€¼æˆ–è€…çŠ¶æ€ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(1)ã€‚

ç”±äº bit æ˜¯è®¡ç®—æœºä¸­æœ€å°çš„å•ä½ï¼Œä½¿ç”¨å®ƒè¿›è¡Œå‚¨å­˜å°†éå¸¸èŠ‚çœç©ºé—´ï¼Œç‰¹åˆ«é€‚åˆä¸€äº›æ•°æ®é‡å¤§ä¸”ä½¿ç”¨**äºŒå€¼ç»Ÿè®¡çš„åœºæ™¯**ã€‚

#### å†…éƒ¨å®ç°

Bitmap æœ¬èº«æ˜¯ç”¨ String ç±»å‹ä½œä¸ºåº•å±‚æ•°æ®ç»“æ„å®ç°çš„ä¸€ç§ç»Ÿè®¡äºŒå€¼çŠ¶æ€çš„æ•°æ®ç±»å‹ã€‚

String ç±»å‹æ˜¯ä¼šä¿å­˜ä¸ºäºŒè¿›åˆ¶çš„å­—èŠ‚æ•°ç»„ï¼Œæ‰€ä»¥ï¼ŒRedis å°±æŠŠå­—èŠ‚æ•°ç»„çš„æ¯ä¸ª bit ä½åˆ©ç”¨èµ·æ¥ï¼Œç”¨æ¥è¡¨ç¤ºä¸€ä¸ªå…ƒç´ çš„äºŒå€¼çŠ¶æ€ï¼Œä½ å¯ä»¥æŠŠ Bitmap çœ‹ä½œæ˜¯ä¸€ä¸ª bit æ•°ç»„ã€‚

#### å¸¸ç”¨å‘½ä»¤

è‡ªå·±å»çœ‹

#### åº”ç”¨åœºæ™¯

1.ç­¾åˆ°ç»Ÿè®¡ 2.åˆ¤æ–­ç”¨æˆ·ç™»é™†æ€ 3.è¿ç»­ç­¾åˆ°ç”¨æˆ·æ€»æ•° ç­‰ç­‰

### GEO

Redis GEO æ˜¯ Redis 3.2 ç‰ˆæœ¬æ–°å¢çš„æ•°æ®ç±»å‹ï¼Œä¸»è¦ç”¨äºå­˜å‚¨åœ°ç†ä½ç½®ä¿¡æ¯ï¼Œå¹¶å¯¹å­˜å‚¨çš„ä¿¡æ¯è¿›è¡Œæ“ä½œã€‚

åœ¨æ—¥å¸¸ç”Ÿæ´»ä¸­ï¼Œæˆ‘ä»¬è¶Šæ¥è¶Šä¾èµ–æœç´¢â€œé™„è¿‘çš„é¤é¦†â€ã€åœ¨æ‰“è½¦è½¯ä»¶ä¸Šå«è½¦ï¼Œè¿™äº›éƒ½ç¦»ä¸å¼€åŸºäºä½ç½®ä¿¡æ¯æœåŠ¡ï¼ˆLocation-Based Serviceï¼ŒLBSï¼‰çš„åº”ç”¨ã€‚LBS åº”ç”¨è®¿é—®çš„æ•°æ®æ˜¯å’Œäººæˆ–ç‰©å…³è”çš„ä¸€ç»„ç»çº¬åº¦ä¿¡æ¯ï¼Œè€Œä¸”è¦èƒ½æŸ¥è¯¢ç›¸é‚»çš„ç»çº¬åº¦èŒƒå›´ï¼ŒGEO å°±éå¸¸é€‚åˆåº”ç”¨åœ¨ LBS æœåŠ¡çš„åœºæ™¯ä¸­

#### å†…éƒ¨å®ç°

GEO æœ¬èº«å¹¶æ²¡æœ‰è®¾è®¡æ–°çš„åº•å±‚æ•°æ®ç»“æ„ï¼Œè€Œæ˜¯ç›´æ¥ä½¿ç”¨äº† Sorted Set é›†åˆç±»å‹ã€‚

GEO ç±»å‹ä½¿ç”¨ GeoHash ç¼–ç æ–¹æ³•å®ç°äº†ç»çº¬åº¦åˆ° Sorted Set ä¸­å…ƒç´ æƒé‡åˆ†æ•°çš„è½¬æ¢ï¼Œè¿™å…¶ä¸­çš„ä¸¤ä¸ªå…³é”®æœºåˆ¶å°±æ˜¯ã€Œå¯¹äºŒç»´åœ°å›¾åšåŒºé—´åˆ’åˆ†ã€å’Œã€Œå¯¹åŒºé—´è¿›è¡Œç¼–ç ã€ã€‚ä¸€ç»„ç»çº¬åº¦è½åœ¨æŸä¸ªåŒºé—´åï¼Œå°±ç”¨åŒºé—´çš„ç¼–ç å€¼æ¥è¡¨ç¤ºï¼Œå¹¶æŠŠç¼–ç å€¼ä½œä¸º Sorted Set å…ƒç´ çš„æƒé‡åˆ†æ•°ã€‚

è¿™æ ·ä¸€æ¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥æŠŠç»çº¬åº¦ä¿å­˜åˆ° Sorted Set ä¸­ï¼Œåˆ©ç”¨ Sorted Set æä¾›çš„â€œæŒ‰æƒé‡è¿›è¡Œæœ‰åºèŒƒå›´æŸ¥æ‰¾â€çš„ç‰¹æ€§ï¼Œå®ç° LBS æœåŠ¡ä¸­é¢‘ç¹ä½¿ç”¨çš„â€œæœç´¢é™„è¿‘â€çš„éœ€æ±‚ã€‚

#### åº”ç”¨åœºæ™¯

1.æŸ¥æ‰¾é™„åŠ çš„äºº è½¦ ç‰©å“

### æ›´å¤šå…³äºRedisçš„æ“ä½œçœ‹å¯ä»¥çœ‹redisä¸­æ–‡æ–‡æ¡£

[Redisä¸­æ–‡æ–‡æ¡£](https://docs.kilvn.com/redis-doc/)



### å…¶ä»–

## ğŸ• ç¼“å­˜è®¾è®¡

ä¸€èˆ¬æƒ…å†µä¸‹æ•°æ®å­˜åœ¨æ•°æ®åº“ä¸­ï¼Œåº”ç”¨ç¨‹åºç›´æ¥æ“ä½œæ•°æ®åº“ã€‚å½“åº”ç”¨ç¨‹åºè®¿é—®é‡ä¸Šä¸‡ï¼Œæ•°æ®åº“å‹åŠ›çªç„¶å¢å¤§ï¼Œå¦‚æœéœ€è¦å‡è½»æ•°æ®åº“æœåŠ¡å™¨çš„å‹åŠ›ï¼Œæœ‰ä»¥ä¸‹æ–¹æ³•ï¼š

- æ•°æ®åº“è¯»å†™åˆ†ç¦»
- æ•°æ®åº“åˆ†åº“åˆ†è¡¨
- ä½¿ç”¨ç¼“å­˜ï¼Œå¹¶å®ç°æ¢ç²—ä½ çš„è¯»å†™åˆ†ç¦»

ç¼“å­˜çš„ä½œç”¨ï¼šå°†åº”ç”¨ç¨‹åºå·²ç»è®¿é—®è¿‡çš„å†…å®¹æˆ–æ•°æ®å­˜å‚¨èµ·æ¥ï¼Œå½“åº”ç”¨ç¨‹åºå†æ¬¡è®¿é—®æ—¶å…ˆæ‰¾ç¼“å­˜ï¼Œç¼“å­˜å‘½ä¸­è¿”å›æ•°æ®ã€‚ä¸å‘½ä¸­å†æŸ¥è¯¢æ•°æ®åº“ï¼Œå¹¶ä¿å­˜åˆ°ç¼“å­˜ã€‚

ç¼“å­˜èƒ½å¤Ÿæœ‰æ•ˆåœ°åŠ é€Ÿåº”ç”¨çš„è¯»å†™é€Ÿåº¦ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥é™ä½åç«¯è´Ÿè½½ï¼Œå¯¹æ—¥å¸¸åº”ç”¨çš„å¼€å‘è‡³å…³é‡è¦ã€‚

### è®¾è®¡å’Œä½¿ç”¨è§„èŒƒ

#### é”®å€¼å¯¹è®¾è®¡

åœ¨Redisä¸­ï¼Œè‰¯å¥½çš„é”®å€¼è®¾è®¡å¯ä»¥è¾¾æˆäº‹åŠåŠŸå€çš„æ•ˆæœï¼Œè€Œä¸å¥½çš„é”®å€¼è®¾è®¡å¯èƒ½ä¼šå¸¦æ¥RedisæœåŠ¡åœæ»ï¼Œç½‘ç»œé˜»å¡ï¼ŒCPUä½¿ç”¨ç‡é£™å‡ç­‰ä¸€ç³»åˆ—é—®é¢˜ï¼Œä¸‹é¢æ¥ç»™å¤§å®¶ä»‹ç»é”®å€¼å¯¹çš„è®¾è®¡

##### key å‘½åè§„èŒƒ

Redisçš„Keyè™½ç„¶å¯ä»¥è‡ªå®šä¹‰ï¼Œä½†æœ€å¥½éµå¾ªä¸‹é¢çš„å‡ ä¸ªæœ€ä½³å®è·µçº¦å®šï¼š

- **éµå¾ªåŸºæœ¬æ ¼å¼**ï¼š`[ä¸šåŠ¡åç§°]:[æ•°æ®å]:[id]` æˆ– `[ä¸šåŠ¡åç§°]:[æ•°æ®å]:[id]:[å­—æ®µå]`

  å„ä¸ªå‘½ååŸŸä¹‹é—´ä¸€èˆ¬ä½¿ç”¨å†’å·åšåˆ†å‰²ç¬¦ï¼Œè¿™æ˜¯ä¸æˆæ–‡çš„è§„çŸ©ã€‚

  ä¾‹å¦‚æˆ‘ä»¬çš„ç™»å½•ä¸šåŠ¡ï¼Œéœ€è¦ä¿å­˜ç”¨æˆ·ä¿¡æ¯ï¼Œå…¶keyå¯ä»¥è®¾è®¡æˆå¦‚ä¸‹æ ¼å¼ï¼š

  ```
  login:user:10
  ```

  

  æˆ–è€…æˆ‘ä»¬åªæƒ³ä¿å­˜ç”¨æˆ·ä¿¡æ¯çš„æŸä¸€ä¸ªå­—æ®µï¼Œå…¶keyå¯ä»¥è®¾è®¡æˆå¦‚ä¸‹æ ¼å¼ï¼š

  ```
  SET login:1:login_times 5 
  SET login:2:login_times 1 
  SET login:3:login_times 2 
  SET login:1:last_login_time 2011-1-1 
  SET login:2:last_login_time 2011-2-1 
  SET login:3:last_login_time 2011-3-1 
  SET login:1:name â€ken thompsonâ€œ 
  SET login:2:name â€œdennis ritchieâ€ 
  SET login:3:name â€Joe Armstrongâ€œ
  ```

  

  è¿™æ ·åœ¨å·²çŸ¥ä¸»é”®çš„æƒ…å†µä¸‹ï¼Œé€šè¿‡getã€setå°±å¯ä»¥è·å¾—æˆ–è€…ä¿®æ”¹ç”¨æˆ·çš„ç™»å½•æ¬¡æ•°å’Œæœ€åç™»å½•æ—¶é—´å’Œå§“åã€‚ ä¸€èˆ¬ç”¨æˆ·æ˜¯æ— æ³•çŸ¥é“è‡ªå·±çš„idçš„ï¼ŒåªçŸ¥é“è‡ªå·±çš„ç”¨æˆ·åï¼Œæ‰€ä»¥è¿˜å¿…é¡»æœ‰ä¸€ä¸ªä»nameåˆ°idçš„æ˜ å°„å…³ç³»ï¼Œè¿™é‡Œçš„è®¾è®¡ä¸ä¸Šé¢çš„æœ‰æ‰€ä¸åŒã€‚

  ```
  SET login:ken thompson:id 1 
  SET login:dennis ritchie:id 2 
  SET login: Joe Armstrong:id 3
  ```

  

  è¿™ç§è®¾è®¡çš„å¥½å¤„ä¸ä»…åœ¨äºå¯è¯»æ€§å¼ºï¼Œè¿˜åœ¨äºå¯ä»¥é¿å…keyçš„å†²çªé—®é¢˜ï¼Œè€Œä¸”æ–¹ä¾¿ç®¡ç†

- **Keyçš„é•¿åº¦ä¸è¶…è¿‡44å­—èŠ‚**

  æ— è®ºæ˜¯å“ªç§æ•°æ®ç±»å‹ï¼Œ keyéƒ½æ˜¯stringç±»å‹ï¼Œstringç±»å‹çš„åº•å±‚ç¼–ç åŒ…å«intã€embstrå’Œrawä¸‰ç§ã€‚å¦‚æœkeyä¸­å…¨æ˜¯æ•°å­—ï¼Œé‚£ä¹ˆå°±ä¼šç›´æ¥ä»¥intç±»å‹å»å­˜å‚¨ï¼Œè€Œintå ç”¨çš„ç©ºé—´ä¹Ÿæ˜¯æœ€å°çš„ï¼Œå½“ç„¶å‡ºäºä¸šåŠ¡éœ€æ±‚ï¼Œæˆ‘ä»¬ä¸å¯èƒ½å°†keyè®¾è®¡ä¸ºä¸€ä¸ªå…¨æ•°å­—çš„ï¼Œè€Œå¦‚æœä¸æ˜¯çº¯æ•°å­—ï¼Œåº•å±‚å­˜å‚¨çš„å°±æ˜¯SDSå†…å®¹ï¼Œå¦‚æœå°äº44å­—èŠ‚ï¼Œå°±ä¼šä½¿ç”¨embstrç±»å‹ï¼Œembstråœ¨å†…å­˜ä¸­æ˜¯ä¸€æ®µè¿ç»­çš„å­˜å‚¨ç©ºé—´ï¼Œå†…å­˜å ç”¨ç›¸å¯¹rawæ¥è¯´è¾ƒå°ï¼Œè€Œå½“å­—èŠ‚æ•°å¤§äº44å­—èŠ‚æ—¶ï¼Œä¼šè½¬ä¸ºrawæ¨¡å¼å­˜å‚¨ï¼Œåœ¨rawæ¨¡å¼ä¸‹ï¼Œå†…å­˜ç©ºé—´ä¸æ˜¯è¿ç»­çš„ï¼Œè€Œæ˜¯é‡‡ç”¨ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘äº†å¦å¤–ä¸€æ®µå†…å­˜ç©ºé—´ï¼Œåœ¨è¿™æ®µç©ºé—´é‡Œå­˜å‚¨SDSå†…å®¹ï¼Œè¿™æ ·ç©ºé—´ä¸è¿ç»­ï¼Œè®¿é—®çš„æ—¶å€™æ€§èƒ½ä¹Ÿå°±ä¼šæ”¶åˆ°å½±å“ï¼Œè¿˜æœ‰å¯èƒ½äº§ç”Ÿå†…å­˜ç¢ç‰‡

  éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœä½ çš„redisç‰ˆæœ¬ä½äº4.0ï¼Œé‚£ä¹ˆç•Œé™æ˜¯39å­—èŠ‚è€Œé44å­—èŠ‚

- **Keyä¸­ä¸åŒ…å«ä¸€äº›ç‰¹æ®Šå­—ç¬¦**

  åŒ…å«ç©ºæ ¼ã€æ¢è¡Œã€å•åŒå¼•å·ä»¥åŠå…¶ä»–è½¬ä¹‰å­—ç¬¦

##### value è®¾è®¡

â– **æ‹’ç» Big Key ï¼ï¼ï¼**

BigKeyé¡¾åæ€ä¹‰å°±æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„Key-valueï¼Œè¿™é‡Œçš„å¤§å¹¶ä¸æ˜¯æŒ‡Keyæœ¬èº«å¾ˆå¤§ï¼Œè€Œæ˜¯æŒ‡åŒ…æ‹¬è¿™ä¸ªKeyçš„Valueåœ¨å†…çš„ä¸€æ•´ä¸ªé”®å€¼å¯¹å¾ˆå¤§

BigKeyé€šå¸¸ä»¥Key-Valueçš„å¤§å°æˆ–è€…Keyä¸­æˆå‘˜çš„æ•°é‡æ¥ç»¼åˆåˆ¤å®šï¼Œä¾‹å¦‚ï¼š

- å­—ç¬¦ä¸²ç±»å‹ï¼šå®ƒçš„bigä½“ç°åœ¨**å•ä¸ªvalueå€¼å¾ˆå¤§**ï¼Œä¸€èˆ¬è®¤ä¸ºè¶…è¿‡10KBå°±æ˜¯bigkey
- éå­—ç¬¦ä¸²ç±»å‹ï¼šå“ˆå¸Œã€åˆ—è¡¨ã€é›†åˆã€æœ‰åºé›†åˆï¼Œå®ƒä»¬çš„bigä½“ç°åœ¨**å…ƒç´ ä¸ªæ•°å¤ªå¤šï¼ˆ5000ä»¥ä¸Šï¼‰**

â– **Big Key çš„å±å®³**

- **ç½‘ç»œé˜»å¡**

  bigkeyä¹Ÿå°±æ„å‘³ç€æ¯æ¬¡è·å–è¦äº§ç”Ÿçš„ç½‘ç»œæµé‡è¾ƒå¤§ï¼Œå‡è®¾ä¸€ä¸ªbigkeyä¸º1MBï¼Œå®¢æˆ·ç«¯æ¯ç§’è®¿é—®é‡ä¸º1000ï¼Œé‚£ä¹ˆæ¯ç§’äº§ç”Ÿ1000MBçš„æµé‡ï¼Œå¯¹äºæ™®é€šçš„åƒå…†ç½‘å¡ï¼ˆæŒ‰ç…§å­—èŠ‚ç®—æ˜¯128MB/sï¼‰çš„æœåŠ¡å™¨æ¥è¯´ç®€ç›´æ˜¯ç­é¡¶ä¹‹ç¾ï¼Œè€Œä¸”ä¸€èˆ¬æœåŠ¡å™¨ä¼šé‡‡ç”¨å•æœºå¤šå®ä¾‹æ–¹å¼æ¥éƒ¨ç½²ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªbigkeyå¯èƒ½ä¼šå¯¹å…¶ä»–å®ä¾‹é€ æˆå½±å“ï¼Œå…¶åæœä¸å ªè®¾æƒ³ã€‚

- **æ•°æ®å€¾æ–œ**

  é›†ç¾¤ç¯å¢ƒä¸‹ï¼Œç”±äºæ‰€æœ‰æ’æ§½ä¸€å¼€å§‹éƒ½æ˜¯å‡è¡¡åˆ†é…çš„ï¼Œå› æ­¤BigKeyæ‰€åœ¨çš„Rediså®ä¾‹å†…å­˜ä½¿ç”¨ç‡ä¼šè¿œè¶…å…¶ä»–å®ä¾‹ï¼Œä»è€Œæ— æ³•ä½¿æ•°æ®åˆ†ç‰‡çš„å†…å­˜èµ„æºè¾¾åˆ°å‡è¡¡ï¼Œæœ€åä¸å¾—ä¸æ‰‹åŠ¨é‡æ–°åˆ†é…æ’æ§½ï¼Œå¢åŠ è¿ç»´äººå‘˜çš„è´Ÿæ‹…

- **é˜»å¡å·¥ä½œçº¿ç¨‹**

  å¯¹å…ƒç´ è¾ƒå¤šçš„hashã€listã€zsetç­‰åšè¿ç®—ä¼šè€—æ—¶è¾ƒä¹…ï¼Œè€Œä¸”ç”±äºRedisæ˜¯å•çº¿ç¨‹çš„ï¼Œåœ¨è¿ç®—è¿‡ç¨‹ä¸­ä¼šå¯¼è‡´æœåŠ¡é˜»å¡ï¼Œæ— æ³•æ¥æ”¶å…¶ä»–ç”¨æˆ·è¯·æ±‚ï¼Œä¾‹å¦‚ï¼šä½¿ç”¨ del åˆ é™¤å¤§ key æ—¶ï¼Œä¼šé˜»å¡å·¥ä½œçº¿ç¨‹ï¼Œè¿™æ ·å°±æ²¡åŠæ³•å¤„ç†åç»­çš„å‘½ä»¤

- **CPUå‹åŠ›**

  å¯¹BigKeyçš„æ•°æ®è¿›è¡Œåºåˆ—åŒ–æˆ–ååºåˆ—åŒ–éƒ½ä¼šå¯¼è‡´CPUçš„ä½¿ç”¨ç‡é£™å‡ï¼Œå½±å“Rediså®ä¾‹å’Œæœ¬æœºå…¶å®ƒåº”ç”¨

â– **Big Key äº§ç”Ÿ**

ä¸€èˆ¬æ¥è¯´bigkeyçš„äº§ç”Ÿéƒ½æ˜¯ç”±äºç¨‹åºè®¾è®¡ä¸å½“ï¼Œæˆ–è€…å¯¹äºæ•°æ®è§„æ¨¡é¢„æ–™ä¸æ¸…æ¥šé€ æˆçš„ï¼Œçœ‹å‡ ä¸ªä¾‹å­ï¼š

- ç¤¾äº¤ç±»ï¼šç²‰ä¸åˆ—è¡¨ï¼Œå¦‚æœæŸäº›æ˜æ˜Ÿç²‰ä¸åˆ—è¡¨è®¾è®¡ä¸å½“ï¼Œå¿…ä¼šé€ æˆbigkey
- ç»Ÿè®¡ç±»ï¼šä¾‹å¦‚æŒ‰å¤©å­˜å‚¨æŸé¡¹åŠŸèƒ½æˆ–è€…ç½‘ç«™çš„ç”¨æˆ·é›†åˆï¼Œé™¤éæ²¡æœ‰äººç”¨ï¼Œå¦åˆ™å¿…ä¼šbigkey
- ç¼“å­˜ç±»ï¼šå°†æ•°æ®ä»æ•°æ®åº“loadå‡ºæ¥åºåˆ—åŒ–åˆ°Redisé‡Œï¼Œè¿™ä¸ªæ–¹å¼å¾ˆå¸¸ç”¨ï¼Œä½†æ˜¯æœ‰ä¸¤ä¸ªåœ°æ–¹éœ€è¦æ³¨æ„ï¼Œç¬¬ä¸€ï¼Œæ˜¯ä¸æ˜¯æœ‰å¿…è¦å§æ‰€æœ‰å­—æ®µéƒ½ç¼“å­˜ï¼›ç¬¬äºŒï¼Œæœ‰æ²¡æœ‰ç›¸å…³å…³è”çš„æ•°æ®ï¼Œæœ‰çš„äººä¸ºäº†æ–¹ä¾¿æŠŠå¾ˆå¤šå…³è”æ•°æ®éƒ½å­˜ä¸€ä¸ªkeyä¸‹ï¼Œäº§ç”Ÿäº†bigkeyã€‚

â– **å‘ç° Big Key**

åˆ©ç”¨ä»¥ä¸‹å‘½ä»¤ï¼Œå¯ä»¥éå†åˆ†ææ‰€æœ‰keyï¼Œå¹¶è¿”å›Keyçš„æ•´ä½“ç»Ÿè®¡ä¿¡æ¯ä¸æ¯ç§æ•°æ®ç±»å‹ä¸­Top1çš„BigKey

```
redis-cli -a å¯†ç  --bigkeys
redis-cli -h 127.0.0.1 -p 6379 -a å¯†ç  -- bigkeys
```



é‚£ä¹ˆå¦‚ä½•åˆ¤æ–­å…ƒç´ çš„å¤§å°å‘¢ï¼Ÿredisä¸­ä¸ºæˆ‘ä»¬æä¾›äº†ç›¸åº”çš„å‘½ä»¤ï¼Œè¯­æ³•å¦‚ä¸‹ï¼š

```
memory usage é”®å
```



è¿™æ¡å‘½ä»¤ä¼šè¿”å›ä¸€æ¡æ•°æ®å ç”¨å†…å­˜çš„æ€»å¤§å°ï¼Œè¿™ä¸ªå¤§å°ä¸ä»…åŒ…æ‹¬Keyå’ŒValueçš„å¤§å°ï¼Œè¿˜åŒ…æ‹¬æ•°æ®å­˜å‚¨æ—¶çš„ä¸€äº›å…ƒä¿¡æ¯ï¼Œå› æ­¤å¯èƒ½ä½ çš„Keyä¸Valueåªå ç”¨äº†å‡ åä¸ªå­—èŠ‚ï¼Œä½†æœ€ç»ˆçš„è¿”å›ç»“æœæ˜¯å‡ ç™¾ä¸ªå­—èŠ‚

ä½†æ˜¯æˆ‘ä»¬ä¸€èˆ¬ä¸æ¨èä½¿ç”¨memoryæŒ‡ä»¤ï¼Œå› ä¸ºè¿™ä¸ªæŒ‡ä»¤å¯¹CPUçš„å ç”¨ç‡æ˜¯å¾ˆé«˜çš„ï¼Œå®é™…å¼€å‘ä¸­æˆ‘ä»¬ä¸€èˆ¬åªéœ€è¦è¡¡é‡Valueçš„å¤§å°æˆ–è€…Keyä¸­çš„æˆå‘˜æ•°å³å¯

ä¾‹å¦‚å¦‚æœæˆ‘ä»¬ä½¿ç”¨çš„æ•°æ®ç±»å‹æ˜¯Stringï¼Œå°±å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼Œè¿”å›çš„ç»“æœæ˜¯Valueçš„é•¿åº¦

```
strlen é”®å
```



å¦‚æœæˆ‘ä»¬ä½¿ç”¨çš„æ•°æ®ç±»å‹æ˜¯Listï¼Œå°±å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼Œè¿”å›çš„ç»“æœæ˜¯Listä¸­æˆå‘˜çš„ä¸ªæ•°

```
llen é”®å
```



â– **åˆ é™¤ Big Key**

BigKeyå†…å­˜å ç”¨è¾ƒå¤šï¼Œå› æ­¤å³ä¾¿æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯åˆ é™¤æ“ä½œï¼Œåˆ é™¤BigKeyä¹Ÿéœ€è¦è€—è´¹å¾ˆé•¿æ—¶é—´ï¼Œå¯¼è‡´Redisä¸»çº¿ç¨‹é˜»å¡ï¼Œå¼•å‘ä¸€ç³»åˆ—é—®é¢˜ã€‚

å¦‚æœredisç‰ˆæœ¬åœ¨4.0ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¼‚æ­¥åˆ é™¤å‘½ä»¤unlinkæ¥åˆ é™¤ä¸€ä¸ªBigKeyï¼Œè¯¥å‘½ä»¤ä¼šå…ˆæŠŠæ•°æ®æ ‡è®°ä¸ºå·²åˆ é™¤ï¼Œç„¶åå†å¼‚æ­¥æ‰§è¡Œåˆ é™¤æ“ä½œã€‚

å¦‚æœredisç‰ˆæœ¬åœ¨4.0ä¹‹å‰ï¼Œé’ˆå¯¹é›†åˆç±»å‹ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆéå†BigKeyä¸­æ‰€æœ‰çš„å…ƒç´ ï¼Œå…ˆå°†å­å…ƒç´ é€ä¸ªåˆ é™¤ï¼Œæœ€åå†åˆ é™¤BigKeyã€‚è‡³äºå¦‚ä½•éå†ï¼Œé’ˆå¯¹ä¸åŒçš„é›†åˆç±»å‹ï¼Œå¯ä»¥å‚è€ƒä»¥ä¸‹ä¸åŒçš„å‘½ä»¤ï¼š

- HSCANï¼ŒSCANï¼ŒSSCANï¼ŒZSCAN

[å‘½ä»¤å‚è€ƒ](http://redisdoc.com/index.html)

â– **ä¼˜åŒ– Big Key**

æ‰¾å‡ºBigKeyä¸­ï¼Œæˆ‘ä»¬åº”è¯¥å¦‚ä½•å¯¹BigKeyè¿›è¡Œä¼˜åŒ–å‘¢ï¼Ÿ

- é€‰æ‹©åˆé€‚çš„æ•°æ®ç±»å‹

  ä¾‹å¦‚ï¼šå®ä½“ç±»å‹ï¼ˆè¦åˆç†æ§åˆ¶å’Œä½¿ç”¨æ•°æ®ç»“æ„ï¼Œä½†ä¹Ÿè¦æ³¨æ„èŠ‚çœå†…å­˜å’Œæ€§èƒ½ä¹‹é—´çš„å¹³è¡¡ï¼‰

  åä¾‹ï¼š

  ```
  COPYset user:1:name zhangsan
  set user:1:age 20
  set user:1:favor pingpong
  ```

  

  æ­£ä¾‹ï¼š

  ```
  COPYhmset user:1 name zhangsan age 19 favor pingpong
  ```

  

- æ§åˆ¶ key çš„ç”Ÿå‘½å‘¨æœŸ

  å»ºè®®ä½¿ç”¨expireè®¾ç½®è¿‡æœŸæ—¶é—´ï¼ˆæ¡ä»¶å…è®¸å¯ä»¥æ‰“æ•£è¿‡æœŸæ—¶é—´ï¼Œé˜²æ­¢é›†ä¸­è¿‡æœŸï¼‰ã€‚

- æ‹†

  - å­—æ®µæ‰“æ•£

    å°†å¯¹è±¡çš„ä¸åŒå±æ€§å­˜å‚¨åˆ°ä¸åŒçš„keyä¸­

    | key         | value |
    | ----------- | ----- |
    | user:1:name | Jack  |
    | user:1:age  | 21    |

    ä¼˜ç‚¹ï¼šå¯ä»¥çµæ´»è®¿é—®å¯¹è±¡ä»»æ„å­—æ®µ

    ç¼ºç‚¹ï¼šç”±äºæ¯æ¡æ•°æ®éƒ½ä¼šæœ‰ä¸€äº›å…ƒä¿¡æ¯éœ€è¦å­˜å‚¨ï¼Œå› æ­¤å°†ä¸€ä¸ªKeyåˆ†æˆå¤šä¸ªKeyè¿›è¡Œå­˜å‚¨ï¼Œå ç”¨çš„å†…å­˜ä¼šå˜çš„æ›´å¤§ï¼Œä¸”ç”±äºå­—æ®µåˆ†æ•£ï¼Œå½“æˆ‘ä»¬éœ€è¦åšç»Ÿä¸€æ§åˆ¶æ—¶ä¼šå˜å¾—å¾ˆå›°éš¾

  - hash

    ä½¿ç”¨hashç»“æ„æ¥å­˜å‚¨å¯¹è±¡ï¼Œå¯¹è±¡çš„ä¸€ä¸ªå±æ€§å¯¹åº”é›†åˆä¸­çš„ä¸€ä¸ªæˆå‘˜

    | user:1 | name | jack |
    | ------ | ---- | ---- |
    | age    | 21   |      |

##### åä¾‹

- åä¾‹1ï¼š

  ```
  redis> SET registryservice:userid:string:100123 "zhangsan"
  ```

  

  key å¤ªé•¿ï¼Œè¿™ä¸ªkeyçš„é•¿åº¦ç”šè‡³å¤§äºvalueé•¿åº¦ï¼Œä¼˜ç‚¹æ˜¯æè¿°ä¿¡æ¯å¾ˆæ˜ç¡®ï¼Œç¼ºç‚¹å°±æ˜¯æµªè´¹å†…å­˜

- åä¾‹2ï¼š

  ```
  SET 6B1B0C32-C2C5-4E48-B6BC-DEFA25E41919 "zhangsan"
  ```

  

  åœ¨åä¾‹1çš„åŸºç¡€ä¸Šï¼ŒKEYæœ¬èº«æ˜¯ä¸ªUUIDï¼Œç¼ºç‚¹ï¼škey å¤ªé•¿ã€å«ä¹‰æ— å¯è¯»æ€§ï¼Œæ— æ³•scan

- åä¾‹3ï¼š

  ```
  SET "!@#/:$%^&*()+100123" "zhangsan"
  ```

  

  åœ¨åä¾‹2çš„åŸºç¡€ä¸Šï¼Œå¢åŠ äº†ç‰¹æ®Šå­—ç¬¦ï¼Œç¼ºç‚¹ï¼šæ— å¯è¯»æ€§ï¼Œéƒ¨åˆ†åœºæ™¯ä¸‹ä¼šå¼•å‘ä¸šåŠ¡å¼‚å¸¸

- åä¾‹4ï¼š

  ```
  SET "a b c d 100123" "sometext"
  ```

  

  key ä¸­åŒ…å«äº†ç©ºæ ¼ï¼Œç¼ºç‚¹ï¼šæ— å¯è¯»æ€§ï¼Œéƒ¨åˆ†åœºæ™¯ä¸‹å¼•å‘ä¸šåŠ¡æ­§ä¹‰

### ç¼“å­˜ç­–ç•¥

å¸¸è§çš„ç¼“å­˜æ›´æ–°ç­–ç•¥ã€‚

- Cache Asideï¼ˆæ—è·¯ç¼“å­˜ï¼‰ç­–ç•¥ï¼›
- Read/Write Throughï¼ˆè¯»ç©¿ / å†™ç©¿ï¼‰ç­–ç•¥ï¼›
- Write Backï¼ˆå†™å›ï¼‰ç­–ç•¥

#### Cache Asideï¼ˆæ—è·¯ç¼“å­˜ï¼‰ç­–ç•¥

Cache Asideï¼ˆæ—è·¯ç¼“å­˜ï¼‰ç­–ç•¥æ˜¯æœ€å¸¸ç”¨çš„ï¼Œåº”ç”¨ç¨‹åºç›´æ¥ä¸ã€Œæ•°æ®åº“ã€ç¼“å­˜ã€äº¤äº’ï¼Œå¹¶è´Ÿè´£å¯¹ç¼“å­˜çš„ç»´æŠ¤ï¼Œè¯¥ç­–ç•¥åˆå¯ä»¥ç»†åˆ†ä¸ºã€Œè¯»ç­–ç•¥ã€å’Œã€Œå†™ç­–ç•¥ã€ã€‚

[![img](https://camo.githubusercontent.com/be983fc1a00404247a007985492877246e88c9481086d2bbd40b358abb2d3aa1/68747470733a2f2f696d672d626c6f672e6373646e696d672e636e2f696d675f636f6e766572742f36653364623362613266383239646463313432333766356337633030653763652e706e67)](https://camo.githubusercontent.com/be983fc1a00404247a007985492877246e88c9481086d2bbd40b358abb2d3aa1/68747470733a2f2f696d672d626c6f672e6373646e696d672e636e2f696d675f636f6e766572742f36653364623362613266383239646463313432333766356337633030653763652e706e67)

**å†™ç­–ç•¥çš„æ­¥éª¤ï¼š**

- å…ˆæ›´æ–°æ•°æ®åº“ä¸­çš„æ•°æ®ï¼Œå†åˆ é™¤ç¼“å­˜ä¸­çš„æ•°æ®ã€‚

**è¯»ç­–ç•¥çš„æ­¥éª¤ï¼š**

- å¦‚æœè¯»å–çš„æ•°æ®å‘½ä¸­äº†ç¼“å­˜ï¼Œåˆ™ç›´æ¥è¿”å›æ•°æ®ï¼›
- å¦‚æœè¯»å–çš„æ•°æ®æ²¡æœ‰å‘½ä¸­ç¼“å­˜ï¼Œåˆ™ä»æ•°æ®åº“ä¸­è¯»å–æ•°æ®ï¼Œç„¶åå°†æ•°æ®å†™å…¥åˆ°ç¼“å­˜ï¼Œå¹¶ä¸”è¿”å›ç»™ç”¨æˆ·ã€‚

æˆ‘ä»¬æ¥æ¢è®¨ä¸‹é¢ä¸¤ä¸ªåœºæ™¯ã€‚

**å…ˆåˆ é™¤ç¼“å­˜å†è·Ÿæ–°æ•°æ®åº“**

ä¸¾ä¸ªä¾‹å­ï¼Œwxggçš„å¹´é¾„æ˜¯ 18ï¼Œè¯·æ±‚ A è¦æ›´æ–°wxggçš„å¹´é¾„ä¸º 19ï¼Œæ‰€ä»¥å®ƒä¼šåˆ é™¤ç¼“å­˜ä¸­çš„å†…å®¹ã€‚è¿™æ—¶ï¼Œå¦ä¸€ä¸ªè¯·æ±‚ B è¦è¯»å–wxggçš„å¹´é¾„ï¼Œå®ƒæŸ¥è¯¢ç¼“å­˜å‘ç°æœªå‘½ä¸­åï¼Œä¼šä»æ•°æ®åº“ä¸­è¯»å–åˆ°å¹´é¾„ä¸º 18ï¼Œå¹¶ä¸”å†™å…¥åˆ°ç¼“å­˜ä¸­ï¼Œç„¶åè¯·æ±‚ A ç»§ç»­æ›´æ”¹æ•°æ®åº“ï¼Œå°†ç”¨æˆ·çš„å¹´é¾„æ›´æ–°ä¸º 19ã€‚æœ€ç»ˆï¼Œè¯¥wxggçš„å¹´é¾„åœ¨ç¼“å­˜ä¸­æ˜¯ 18ï¼ˆæ—§å€¼ï¼‰ï¼Œåœ¨æ•°æ®åº“ä¸­æ˜¯ 19ï¼ˆæ–°å€¼ï¼‰ï¼Œç¼“å­˜å’Œæ•°æ®åº“çš„æ•°æ®ä¸ä¸€è‡´ã€‚

**å…ˆè·Ÿæ–°æ•°æ®åº“å†åˆ é™¤ç¼“å­˜**

å‡è®¾wxggçš„å¹´é¾„åœ¨ç¼“å­˜ä¸­ä¸å­˜åœ¨ï¼Œè¯·æ±‚ A è¯»å–æ•°æ®æ—¶ä»æ•°æ®åº“ä¸­æŸ¥è¯¢åˆ°å¹´é¾„ä¸º 18ï¼Œåœ¨æœªå†™å…¥ç¼“å­˜ä¸­æ—¶å¦ä¸€ä¸ªè¯·æ±‚ B æ›´æ–°æ•°æ®ã€‚å®ƒæ›´æ–°æ•°æ®åº“ä¸­çš„å¹´é¾„ä¸º 19ï¼Œå¹¶ä¸”æ¸…ç©ºç¼“å­˜ã€‚è¿™æ—¶è¯·æ±‚ A æŠŠä»æ•°æ®åº“ä¸­è¯»åˆ°çš„å¹´é¾„ä¸º 18çš„æ•°æ®å†™å…¥åˆ°ç¼“å­˜ä¸­ã€‚æœ€ç»ˆç¼“å­˜ä¸º18ï¼Œæ•°æ®åº“ä¸º19ã€‚è¿˜æ˜¯ä¼šå­˜åœ¨æ•°æ®åº“ä¸ä¸€è‡´çš„é—®é¢˜ã€‚**ä½†æ˜¯åœ¨å®é™…ä¸­ï¼Œè¿™ä¸ªé—®é¢˜å‡ºç°çš„æ¦‚ç‡å¹¶ä¸é«˜**ã€‚

**å› ä¸ºç¼“å­˜çš„å†™å…¥é€šå¸¸è¦è¿œè¿œå¿«äºæ•°æ®åº“çš„å†™å…¥ï¼**

æ‰€ä»¥è¯´åœ¨Aå†™å…¥ç¼“å­˜18çš„é€Ÿåº¦ è¿œè¿œå¿«äº Bå†™å…¥æ•°æ®åº“19çš„é€Ÿåº¦ã€‚

Cache Aside ç­–ç•¥é€‚åˆ**è¯»å¤šå†™å°‘**çš„åœºæ™¯ï¼Œä¸é€‚åˆå†™å¤šçš„åœºæ™¯ï¼Œå› ä¸ºå½“å†™å…¥æ¯”è¾ƒé¢‘ç¹æ—¶ï¼Œç¼“å­˜ä¸­çš„æ•°æ®ä¼šè¢«é¢‘ç¹åœ°æ¸…ç†ï¼Œè¿™æ ·ä¼šå¯¹ç¼“å­˜çš„å‘½ä¸­ç‡æœ‰ä¸€äº›å½±å“ã€‚å¦‚æœä¸šåŠ¡å¯¹ç¼“å­˜å‘½ä¸­ç‡æœ‰ä¸¥æ ¼çš„è¦æ±‚ï¼Œé‚£ä¹ˆå¯ä»¥è€ƒè™‘ä¸¤ç§è§£å†³æ–¹æ¡ˆï¼š

- ä¸€ç§åšæ³•æ˜¯åœ¨æ›´æ–°æ•°æ®æ—¶ä¹Ÿæ›´æ–°ç¼“å­˜ï¼Œåªæ˜¯åœ¨æ›´æ–°ç¼“å­˜å‰å…ˆåŠ ä¸€ä¸ªåˆ†å¸ƒå¼é”ï¼Œå› ä¸ºè¿™æ ·åœ¨åŒä¸€æ—¶é—´åªå…è®¸ä¸€ä¸ªçº¿ç¨‹æ›´æ–°ç¼“å­˜ï¼Œå°±ä¸ä¼šäº§ç”Ÿå¹¶å‘é—®é¢˜äº†ã€‚å½“ç„¶è¿™ä¹ˆåšå¯¹äºå†™å…¥çš„æ€§èƒ½ä¼šæœ‰ä¸€äº›å½±å“ï¼›
- å¦ä¸€ç§åšæ³•åŒæ ·ä¹Ÿæ˜¯åœ¨æ›´æ–°æ•°æ®æ—¶æ›´æ–°ç¼“å­˜ï¼Œåªæ˜¯ç»™ç¼“å­˜åŠ ä¸€ä¸ªè¾ƒçŸ­çš„è¿‡æœŸæ—¶é—´ï¼Œè¿™æ ·å³ä½¿å‡ºç°ç¼“å­˜ä¸ä¸€è‡´çš„æƒ…å†µï¼Œç¼“å­˜çš„æ•°æ®ä¹Ÿä¼šå¾ˆå¿«è¿‡æœŸï¼Œå¯¹ä¸šåŠ¡çš„å½±å“ä¹Ÿæ˜¯å¯ä»¥æ¥å—ã€‚

å…¶ä»–ç¼“å­˜ç­–ç•¥è‡ªè¡Œäº†è§£............................



## Go æ“ä½œRedis

##### 	æˆ‘ä»¬åˆ©ç”¨go-redisåº“å®ç°

```
"github.com/go-redis/redis"
```

### 1,é“¾æ¥

ä¸€èˆ¬æ¥è¯´è®¾ç½®å¦‚ä¸‹ï¼š

```go
var redisDB *redis.Client

func initClient() (err error) {
	redisDB = redis.NewClient(&redis.Options{
		Addr:     "localhost:6379",		//åœ°å€:ç«¯å£
		Password: "",					//å¯†ç ï¼Œæ²¡æœ‰å°±å†™ç©ºå­—ç¬¦ä¸²""
		DB:       0,  					//ä½¿ç”¨å“ªä¸ªæ•°æ®åº“ï¼Œ0ä»£è¡¨é»˜è®¤æ•°æ®åº“
	})
	_, err = redisDB.Ping().Result()
	if err != nil {
		return err
	}
	return nil
}
```

è¿˜æœ‰æ›´å¤šè®¾ç½®å¯å»[å®˜æ–¹åœ°å€ https://github.com/go-redis](https://github.com/go-redis)æŸ¥çœ‹



### 2,SET

```
// key val è¿‡æœŸæ—¶é—´
func Set(key string, val string, expiration time.Duration) error {
	return redisDB.Set(key, val, expiration).Err()
}
```



### 3,GET

```
// key
func Get(key string) (string, error) {
	return redisDB.Get(key).Result()
}
```



### 4,ZSET

```
func Zset(key string, val []redis.Z) error {
	_, err := redisDB.ZAdd(key, val...).Result()
	if err != nil {
		fmt.Printf("zadd failed, err:%v\n", err)
		return err
	}
	return nil
}

func main() {
	err := initClient()
	if err != nil {
		log.Fatalln("init redis is err:", err)
		return
	}
	key := "language_rank"
	languages := []redis.Z{
		redis.Z{Score: 80, Member: "go"},
		redis.Z{Score: 88, Member: "java"},
		redis.Z{Score: 70, Member: "c++"},
	}
	err = Zset(key, languages)
	if err != nil {
		log.Fatalln("zset redis is err:", err)
		return
	}
	op := redis.ZRangeBy{
		Min: "60",
		Max: "85",
	}
	ret, err := redisDB.ZRangeByScoreWithScores(key, op).Result()
	if err != nil {
		fmt.Printf("zrangebyscore failed, err:%v\n", err)
		return
	}
	for _, z := range ret {
		fmt.Println(z.Member, z.Score)
	}
}
```



## ä½œä¸š

### Lv0

å®‰è£…redisï¼Œå°†è¯¾ä»¶çš„redis å‘½ä»¤ å’Œä»£ç  è‡ªå·±æ•²ä¸€é

### Lv1

ç»“åˆGin çš„ä½œä¸š

å†™ä¸€ä¸ªè·å–ç”¨æˆ·ä¿¡æ¯çš„æ¥å£ åšç®€å•çš„ç¼“å­˜å¤„ç†

### Lv2

ç»“åˆgin redis å†™ä¸€ä¸ªç‚¹èµåŠŸèƒ½çš„æ¥å£ï¼ˆåªèƒ½ç‚¹èµä¸€æ¬¡ï¼‰

### æäº¤ä½œä¸š

**ä¸»é¢˜æ ¼å¼** `Lv3-åå­—-202221xxxx` è®°å¾—ä¸€ç‚¹è¦æŒ‰ç…§æ ¼å¼æ¥å†™

é‚®ç®±å‘é€åˆ° `yuqin_z@qq.com`